import{e as Te,c as Ts,r as l,j as e,B as J,X as Kt,T as js,k as vs,C as Ps,f as Jt,c0 as rt,g as Ie,R as Qs,I as Wt,o as Yt,p as Gt,bQ as Xt,s as $e,q as cs,v as Ue,h as Zs,a as Qt,u as Zt}from"./index-CLIkutcF.js";import{C,a as _,b as B,d as L,I as Y,c as Ce}from"./Combination-VzPjPnOx.js";import{F as is,g as As,B as Q,f as Ms,R as ns,b as it,c as ea,d as sa,e as ta,a as et,T as He,h as Rs,S as lt}from"./tooltip-BzEeHMsZ.js";import{T as rs}from"./textarea-BeCFIVKL.js";import{C as fs,L as A,S as Be,b as De,c as Ve,d as ze,e as y,g as ye,h as we,u as aa,i as ct}from"./checkbox-B8vwzNvb.js";import{S as ts,L as Fs,u as na,d as ra,U as us}from"./separator-BLcX6XFs.js";import{q as ls,A as _s,B as Is,V as ia,W as ot,T as la,k as ca,l as st,n as Fe,o as oa,p as _e,O as da,K as ks,N as Ss,F as dt,G as mt,H as he,J as ue,Z as ma,M as xa,Q as ha,X as ua,Y as ga}from"./BatchUploadResults-DDs0gbJS.js";import{C as xt,S as Ee}from"./shield-klLB-pUT.js";import{S as Le,a as gs,T as as}from"./switch-Bjue1puZ.js";import{a as K}from"./api-dGCjnlFh.js";import{E as ja}from"./EnhancedRegister-CfCga3ys.js";/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ht=Te("activity",fa);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],va=Te("calendar-days",pa);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],ba=Te("octagon-alert",Na);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],wa=Te("palette",ya);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],ka=Te("percent",Ra);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],ut=Te("sparkles",Sa);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ca=Te("square",Aa),La=({decision:s,loanOffer:t,onDecisionAction:r,onEditOffer:a,onDownloadPDF:i,onSendOffer:v,onDeclineOffer:m,isLender:N=!0})=>{var F,G,H,V,X,Z,O,ae,re,ee,ne,de,Pe,je;const{toast:j}=Ts(),[b,x]=l.useState((s==null?void 0:s.internalNotes)||""),[g,c]=l.useState(!1),[R,n]=l.useState(!1),f=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A",k=M=>{const q="inline-flex items-center rounded-full text-xs font-medium px-3 py-1";switch(M==null?void 0:M.toLowerCase()){case"approve":return e.jsxs(Q,{className:`${q} bg-green-100 text-green-800 border border-green-200`,children:[e.jsx(Ps,{className:"h-4 w-4 mr-1"}),"Approved"]});case"reject":return e.jsxs(Q,{className:`${q} bg-red-100 text-red-800 border border-red-200`,children:[e.jsx(vs,{className:"h-4 w-4 mr-1"}),"Rejected"]});case"hold":return e.jsxs(Q,{className:`${q} bg-orange-100 text-orange-800 border border-orange-200`,children:[e.jsx(Ms,{className:"h-4 w-4 mr-1"}),"Hold"]});case"review":default:return e.jsxs(Q,{className:`${q} bg-yellow-100 text-yellow-800 border border-yellow-200`,children:[e.jsx(fs,{className:"h-4 w-4 mr-1"}),"Under Review"]})}},E=async()=>{n(!0);try{j({title:"Notes Saved",description:"Internal notes have been saved successfully.",variant:"default"}),c(!1)}catch{j({title:"Error",description:"Failed to save notes. Please try again.",variant:"destructive"})}finally{n(!1)}},W=(M,q,ie)=>{if(!M||!ie)return 0;if(q===0)return M/ie;const me=q/100/12;return M*me*Math.pow(1+me,ie)/(Math.pow(1+me,ie)-1)},P=Number((t==null?void 0:t.amount)??(t==null?void 0:t.maxAmount)??0)||0,o=Number((t==null?void 0:t.interestRate)??0)||0,T=Number((t==null?void 0:t.termMonths)??(t==null?void 0:t.term)??0)||0,w=W(P,o,T),I=(M,q)=>q||(typeof M!="number"?"N/A":M<.15?"Excellent":M<.25?"Good":M<.35?"Fair":"Poor");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{className:"border-l-4 border-l-blue-500",children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5 text-blue-600"}),"Loan Decision Status"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[k(s==null?void 0:s.decision),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["by ",(s==null?void 0:s.decisionBy)||"System"," on ",f(s==null?void 0:s.timestamp)]})]}),(s==null?void 0:s.decision)==="Approve"&&e.jsx("div",{className:"text-green-600 text-sm font-medium",children:"ðŸ’¼ Loan Approved"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"Decision Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Decision:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.decision)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Score:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.score)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Classification:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.classification)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk Tier:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.riskTier)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk Label:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.riskTierLabel)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Default Risk:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.defaultRiskEstimate)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DTI Ratio:"}),e.jsx("span",{className:"font-medium",children:typeof(s==null?void 0:s.dti)=="number"?`${(s.dti*100).toFixed(1)}%`:typeof((F=s==null?void 0:s.scoreResult)==null?void 0:F.dtiRatio)=="number"?`${(s.scoreResult.dtiRatio*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DTI Rating:"}),e.jsx("span",{className:"font-medium",children:I(typeof(s==null?void 0:s.dti)=="number"?s.dti:(G=s==null?void 0:s.scoreResult)==null?void 0:G.dtiRatio,s==null?void 0:s.dtiRating)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"Processing Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Decision Date:"}),e.jsx("span",{className:"font-medium",children:f(s==null?void 0:s.timestamp)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Decision By:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.decisionBy)||"System"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Engine Version:"}),e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.engineVersion)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Manual Override:"}),e.jsx("span",{className:"font-medium",children:s!=null&&s.isManual?"Yes":"No"})]}),(s==null?void 0:s.rejectionCode)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rejection Code:"}),e.jsx("span",{className:"font-medium text-red-600",children:s.rejectionCode})]})]})]})]}),(s==null?void 0:s.scoringDetails)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"Scoring Engine Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Recession Mode:"}),e.jsx("span",{className:"font-medium",children:s.scoringDetails.recessionMode?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"AI Enabled:"}),e.jsx("span",{className:"font-medium",children:s.scoringDetails.aiEnabled?"Yes":"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"Customer Profile"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Employment:"}),e.jsx("span",{className:"font-medium",children:((H=s.customerProfile)==null?void 0:H.employmentStatus)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active Loans:"}),e.jsx("span",{className:"font-medium",children:((V=s.customerProfile)==null?void 0:V.activeLoans)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Delinquency:"}),e.jsx("span",{className:"font-medium",children:((X=s.customerProfile)==null?void 0:X.lastDelinquency)==="N/A"?"N/A":`${(Z=s.customerProfile)==null?void 0:Z.lastDelinquency} months ago`})]})]})]})]}),(s==null?void 0:s.reasons)&&s.reasons.length>0&&e.jsxs("div",{className:`p-4 ${((O=s==null?void 0:s.decision)==null?void 0:O.toLowerCase())==="reject"?"bg-red-50 dark:bg-red-900/20":"bg-green-50 dark:bg-green-900/20"} rounded-lg`,children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:((ae=s==null?void 0:s.decision)==null?void 0:ae.toLowerCase())==="reject"?"Rejection Reasons":"Decision Reasons"}),e.jsx("div",{className:"space-y-1",children:s.reasons.map((M,q)=>{var ie;return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:((ie=s==null?void 0:s.decision)==null?void 0:ie.toLowerCase())==="reject"?"text-red-600":"text-green-600",children:"â€¢"}),e.jsx("span",{children:M})]},q)})})]})]})})]}),t&&e.jsxs(C,{className:"border-l-4 border-l-green-500",children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5 text-green-600"}),"Final Offer Details"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loan Amount Offered"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P===0?"$0 (Not Eligible)":`$${P.toLocaleString()}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ka,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Interest Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[o.toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Term (Months)"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:T>0?`${T} months`:"N/A"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Estimated Monthly Payment"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",w.toFixed(2)]})]})]}),e.jsx(ts,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"APR"}),e.jsxs("div",{className:"text-lg font-semibold",children:[(o+.5).toFixed(2),"%"]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Interest"}),e.jsxs("div",{className:"text-lg font-semibold",children:["$",(w*T-P).toFixed(2)]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Repayment"}),e.jsx("div",{className:"text-lg font-semibold",children:T>0?`$${(w*T).toFixed(2)}`:"N/A"})]})]}),(t==null?void 0:t.pricingModel)&&e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-3",children:"Pricing Model Breakdown"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Base Rate:"}),e.jsxs("span",{className:"font-medium",children:[((re=t.pricingModel.baseRate)==null?void 0:re.toFixed(2))||"N/A","%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"DTI Adjustment:"}),e.jsx("span",{className:"font-medium",children:(ee=t.pricingModel.adjustments)!=null&&ee.dtiAdjustment?`+${t.pricingModel.adjustments.dtiAdjustment.toFixed(2)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"DTI Rating Adjustment:"}),e.jsx("span",{className:"font-medium",children:(ne=t.pricingModel.adjustments)!=null&&ne.dtiRatingAdjustment?`+${t.pricingModel.adjustments.dtiRatingAdjustment.toFixed(2)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Recession Adjustment:"}),e.jsx("span",{className:"font-medium",children:(de=t.pricingModel.adjustments)!=null&&de.recessionAdjustment?`+${t.pricingModel.adjustments.recessionAdjustment.toFixed(2)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Payment Adjustment:"}),e.jsx("span",{className:"font-medium",children:(Pe=t.pricingModel.adjustments)!=null&&Pe.paymentAdjustment?`+${t.pricingModel.adjustments.paymentAdjustment.toFixed(2)}%`:"N/A"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm font-semibold border-t pt-2",children:[e.jsx("span",{children:"Final Rate:"}),e.jsxs("span",{className:"text-purple-600",children:[((je=t.pricingModel.finalRate)==null?void 0:je.toFixed(2))||"N/A","%"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("p",{children:"â€¢ Base rate determined by risk tier"}),e.jsx("p",{children:"â€¢ Adjustments applied for risk factors"}),e.jsx("p",{children:"â€¢ Final rate capped at 35.99%"})]})]})]})]}),(t==null?void 0:t.availableTerms)&&t.availableTerms.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"Available Terms"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.availableTerms.map((M,q)=>e.jsxs(Q,{variant:"outline",className:"text-orange-700 border-orange-300",children:[M," months"]},q))})]}),t.expirationDate&&e.jsx("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:["Offer Expiration Date: ",new Date(t.expirationDate).toLocaleDateString()]})]})})]})})]}),e.jsxs(C,{className:"border-l-4 border-l-purple-500",children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5 text-purple-600"}),"ðŸ“„ Internal Notes"]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-4",children:g?e.jsxs("div",{className:"space-y-3",children:[e.jsx(rs,{placeholder:"Enter internal notes for underwriter/lender input (max 1000 chars)...",value:b,onChange:M=>x(M.target.value.slice(0,1e3)),className:"min-h-[120px]",maxLength:1e3}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[b.length,"/1000 characters"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>{x((s==null?void 0:s.internalNotes)||""),c(!1)},children:[e.jsx(Kt,{className:"h-4 w-4 mr-1"}),"Cancel"]}),e.jsxs(J,{size:"sm",onClick:E,disabled:R,children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),R?"Saving...":"Save Notes"]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg min-h-[120px]",children:b?e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:b}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:'No internal notes added yet. Click "Edit Notes" to add underwriter comments.'})}),N&&e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>c(!0),children:[e.jsx(Is,{className:"h-4 w-4 mr-1"}),"Edit Notes"]})]})})})]}),(s==null?void 0:s.riskFlags)&&s.riskFlags.length>0&&e.jsxs(C,{className:"border-l-4 border-l-red-500",children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-red-600"}),"Risk Flags & Warnings"]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-2",children:s.riskFlags.map((M,q)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx(js,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-800 dark:text-red-200",children:M})]},q))})})]})]})},tt=({alerts:s})=>e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(B,{children:"Alerts & Monitoring"}),e.jsx(J,{variant:"ghost",size:"icon",children:e.jsx(Jt,{className:"h-5 w-5"})})]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-4",children:s.length>0?s.map((t,r)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full mt-1 ${t.type==="critical"?"bg-red-100":"bg-yellow-100"}`,children:e.jsx(js,{className:`h-4 w-4 ${t.type==="critical"?"text-red-600":"text-yellow-600"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.time})]})]},r)):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No alerts at this time"})})})]}),ps=({decision:s,size:t="default"})=>{const r="inline-flex items-center rounded-full text-xs font-medium",a=t==="large"?"px-3 py-1 text-sm":"px-2.5 py-0.5 text-xs",i=t==="large"?"h-4 w-4":"h-3 w-3";switch((s||"").toLowerCase()){case"approve":return e.jsxs("span",{className:`${r} ${a} bg-green-100 text-green-800`,children:[e.jsx(Ps,{className:`${i} mr-1`}),"Approved"]});case"reject":return e.jsxs("span",{className:`${r} ${a} bg-red-100 text-red-800`,children:[e.jsx(vs,{className:`${i} mr-1`}),"Rejected"]});case"hold":return e.jsxs("span",{className:`${r} ${a} bg-orange-100 text-orange-800`,children:[e.jsx(Ms,{className:`${i} mr-1`}),"Hold"]});case"review":default:return e.jsxs("span",{className:`${r} ${a} bg-yellow-100 text-yellow-800`,children:[e.jsx(fs,{className:`${i} mr-1`}),"Review"]})}},at=({recentDecisions:s})=>e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(B,{children:"Recent Decisions"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-4",children:s.length>0?s.map((t,r)=>{var a,i,v;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:((a=t.user)==null?void 0:a.name)||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((i=t.user)==null?void 0:i.email)||"No email"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ps,{decision:((v=t.lendingDecision)==null?void 0:v.decision)||"Review"})})]},r)}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No recent decisions"})})})]}),Ea=({darkMode:s,toggleDarkMode:t,refreshing:r,pollingState:a,onRefresh:i,onOpenBatchUpload:v,onOpenRegister:m})=>e.jsxs("div",{className:"mb-8 flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-2xl bg-gradient-to-r from-indigo-500 to-purple-500 p-3 shadow-lg",children:e.jsx(rt,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"Lender Dashboard"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Advanced loan decision platform"})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(J,{onClick:i,variant:"outline",size:"lg",className:"group border-border bg-card hover:bg-muted transition-all duration-300",disabled:(a==null?void 0:a.consecutiveErrors)>=10,children:[e.jsx(ns,{className:`h-4 w-4 ${r?"animate-spin":"group-hover:rotate-45"} transition-transform duration-300`}),"Refresh",(a==null?void 0:a.consecutiveErrors)>0&&e.jsx(Q,{variant:"destructive",className:"ml-2 text-xs",children:a.consecutiveErrors})]}),e.jsxs(J,{onClick:v,variant:"outline",size:"lg",className:"border-border bg-card hover:bg-muted transition-all duration-300",children:[e.jsx(ia,{className:"h-4 w-4"}),"Batch Upload"]}),e.jsxs(J,{onClick:m,size:"lg",className:"bg-gradient-to-r from-indigo-500 to-purple-500 hover:opacity-90 transition-opacity shadow-lg",children:[e.jsx(ot,{className:"h-4 w-4"}),"Register User"]}),e.jsx(it,{children:e.jsxs(ea,{children:[e.jsx(sa,{asChild:!0,children:e.jsx(J,{onClick:t,variant:"outline",size:"lg",className:"border-border bg-card hover:bg-muted transition-all duration-300",children:s?e.jsx(ut,{className:"h-4 w-4 text-amber-500"}):e.jsx(ht,{className:"h-4 w-4 text-indigo-500"})})}),e.jsxs(ta,{children:["Toggle ",s?"light":"dark"," mode"]})]})})]})]}),Ta=({users:s,handleUserSelect:t,renderDecisionBadge:r})=>e.jsxs(la,{children:[e.jsx(ca,{children:e.jsxs(st,{children:[e.jsx(Fe,{children:"Borrower"}),e.jsx(Fe,{children:"Status"}),e.jsx(Fe,{children:"Credit Score"}),e.jsx(Fe,{children:"Risk Level"}),e.jsx(Fe,{children:"Decision"}),e.jsx(Fe,{children:"Actions"})]})}),e.jsx(oa,{children:s.map(a=>{var i,v,m,N,j,b,x,g,c,R,n,f,k;return e.jsxs(st,{children:[e.jsxs(_e,{children:[e.jsx("div",{className:"font-medium",children:a.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.email||"N/A"})]}),e.jsx(_e,{children:e.jsx(Q,{variant:"outline",children:a.status||"inactive"})}),e.jsx(_e,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2 text-muted-foreground"}),a.creditScore||"N/A"]})}),e.jsx(_e,{children:e.jsx(Q,{variant:(v=(i=a.lendingDecision)==null?void 0:i.riskFlags)!=null&&v.highDTI||(N=(m=a.lendingDecision)==null?void 0:m.riskFlags)!=null&&N.hasDefaults?"destructive":(b=(j=a.lendingDecision)==null?void 0:j.riskFlags)!=null&&b.hasMissedPayments?"warning":"default",children:(g=(x=a.lendingDecision)==null?void 0:x.riskFlags)!=null&&g.highDTI||(R=(c=a.lendingDecision)==null?void 0:c.riskFlags)!=null&&R.hasDefaults?"High Risk":(f=(n=a.lendingDecision)==null?void 0:n.riskFlags)!=null&&f.hasMissedPayments?"Medium Risk":"Low Risk"})}),e.jsx(_e,{children:e.jsx("div",{className:"flex items-center",children:r(((k=a.lendingDecision)==null?void 0:k.decision)||"Review")})}),e.jsx(_e,{children:e.jsx(J,{size:"sm",onClick:()=>t(a),children:"Review"})})]},a._id)})})]}),Pa=({searchQuery:s,onSearchChange:t,users:r,loading:a,onSelectUser:i})=>e.jsxs(C,{className:"mb-8 overflow-hidden border-0 bg-card shadow-lg transition-all duration-300 hover:shadow-xl",children:[e.jsx(_,{className:"bg-gradient-to-r from-muted/50 to-muted/30 p-6",children:e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(et,{className:"absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-muted-foreground"}),e.jsx(Y,{type:"text",placeholder:"Search borrowers by name, email, or phone...",className:"pl-12 h-12 border-0 bg-background shadow-inner text-lg placeholder:text-muted-foreground focus:ring-2 focus:ring-indigo-500",value:s,onChange:t})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(J,{variant:"outline",onClick:()=>t({target:{value:""}}),disabled:!s,className:"h-12 border-border bg-background hover:bg-muted transition-colors",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Clear"]}),e.jsxs(J,{className:"h-12 bg-gradient-to-r from-indigo-500 to-purple-500 hover:opacity-90 transition-opacity shadow-lg",onClick:()=>t({target:{value:s}}),children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"Search"]})]})]})}),e.jsx(L,{className:"p-0",children:r.length>0?e.jsx("div",{className:"animate-fade-in",children:e.jsx(Ta,{users:r,handleUserSelect:i,renderDecisionBadge:ps})}):e.jsx("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:a?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Fs,{className:"h-8 w-8 animate-spin text-indigo-500"}),e.jsx("p",{className:"text-muted-foreground",children:"Searching borrowers..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-full bg-muted p-6",children:e.jsx(da,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"No borrowers found"}),e.jsx("p",{className:"text-muted-foreground",children:"Start typing to search for borrowers"})]})]})})})]}),Ma=({userCreditData:s,isEditingDecision:t,manualDecision:r,handleManualDecision:a,user:i})=>{var v,m,N,j,b,x,g;return e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-600"}),"Risk Tier Override"]}),(i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="lender"?e.jsx(Q,{variant:"outline",className:"text-xs text-green-600 border-green-600",children:"Senior Underwriter Access"}):e.jsx(Q,{variant:"outline",className:"text-xs text-gray-500",children:"Senior Underwriter Only"})]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Risk Tier:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Q,{variant:((v=s==null?void 0:s.lendingDecision)==null?void 0:v.riskTier)==="low"?"default":((m=s==null?void 0:s.lendingDecision)==null?void 0:m.riskTier)==="medium"?"secondary":"destructive",children:((N=s==null?void 0:s.lendingDecision)==null?void 0:N.riskTierLabel)||((j=s==null?void 0:s.lendingDecision)==null?void 0:j.riskTier)||"Not Assigned"}),((b=s==null?void 0:s.lendingDecision)==null?void 0:b.riskTierOverride)&&e.jsx(Q,{variant:"outline",className:"text-orange-600 border-orange-600",children:"Overridden"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Score:"}),e.jsx("div",{className:"text-lg font-bold",children:((x=s==null?void 0:s.lendingDecision)==null?void 0:x.score)||"N/A"})]})]}),t&&((i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="lender")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"risk-tier-override",children:"Override Risk Tier"}),e.jsxs(Be,{value:r.riskTierOverride,onValueChange:c=>a("riskTierOverride",c),children:[e.jsx(De,{className:"w-full",children:e.jsx(Ve,{placeholder:"Select risk tier override"})}),e.jsxs(ze,{children:[e.jsx(y,{value:"low",children:"Low Risk"}),e.jsx(y,{value:"medium",children:"Medium Risk"}),e.jsx(y,{value:"high",children:"High Risk"}),e.jsx(y,{value:"none",children:"No Override"})]})]})]}),r.riskTierOverride&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"override-justification",children:"Override Justification"}),e.jsx(rs,{id:"override-justification",placeholder:"Explain the reason for this risk tier override...",value:r.overrideJustification,onChange:c=>a("overrideJustification",c.target.value),className:"mt-1"})]})]}),((g=s==null?void 0:s.lendingDecision)==null?void 0:g.overrideJustification)&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Risk Tier Override Applied"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.lendingDecision.overrideJustification})]})]})})]})})]})},Fa=({lendingDecision:s})=>{var b,x,g,c;if(!s)return null;const t=s.engine==="LendingDecisionEngine"&&s.version&&s.decision&&Array.isArray(s.loanOffers),r=R=>R?new Date(R).toLocaleString():"N/A",a=R=>e.jsx("div",{className:"space-y-4",children:R.map((n,f)=>e.jsxs(C,{className:"bg-blue-50 dark:bg-blue-900/10",children:[e.jsx(_,{children:e.jsxs(B,{children:["Loan Offer ",n.offerId?`#${n.offerId}`:`#${f+1}`]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",n.offerType]}),e.jsxs("div",{children:[e.jsx("b",{children:"Amount:"})," ",n.amount," ",n.currency]}),e.jsxs("div",{children:[e.jsx("b",{children:"Term:"})," ",n.term," months"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Interest Rate:"})," ",n.interestRate,"%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"APR:"})," ",n.apr,"%"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly Payment:"})," ",n.monthlyPayment]}),e.jsxs("div",{children:[e.jsx("b",{children:"Security Type:"})," ",n.securityType]}),n.fees&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("b",{children:"Fees:"})," ",JSON.stringify(n.fees)]}),n.amortizationSchedule&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("b",{children:"Amortization Schedule:"})," ",e.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(n.amortizationSchedule,null,2)})]}),n.disclosures&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("b",{children:"Disclosures:"})," ",e.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(n.disclosures,null,2)})]})]})})]},n.offerId||f))}),[i,v]=Qs.useState(!1),[m,N]=Qs.useState(!1);if(t){const{engine:R,version:n,timestamp:f,decision:k,loanOffers:E,scoreDetails:W,performanceMetrics:P}=s;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5 text-blue-600"}),"Lending Decision Engine Output"]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Engine:"})," ",R]}),e.jsxs("div",{children:[e.jsx("b",{children:"Version:"})," ",n]}),e.jsxs("div",{children:[e.jsx("b",{children:"Timestamp:"})," ",r(f)]})]}),e.jsxs("div",{className:"space-y-2 text-sm col-span-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Decision"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",k.status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Reason:"})," ",k.reason]}),e.jsxs("div",{children:[e.jsx("b",{children:"Approved Amount:"})," ",k.approvedAmount]}),e.jsxs("div",{children:[e.jsx("b",{children:"Risk Category:"})," ",k.riskCategory]}),e.jsxs("div",{children:[e.jsx("b",{children:"DTI Status:"})," ",k.dtiStatus]}),e.jsxs("div",{children:[e.jsx("b",{children:"Loan to Value:"})," ",k.loanToValue]}),e.jsxs("div",{children:[e.jsx("b",{children:"Debt Service Coverage Ratio:"})," ",k.debtServiceCoverageRatio]}),k.verificationFlags&&k.verificationFlags.length>0&&e.jsxs("div",{children:[e.jsx("b",{children:"Verification Flags:"})," ",k.verificationFlags.join(", ")]})]})]})})]}),E&&E.length>0&&e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(B,{children:"Loan Offers"})}),e.jsx(L,{children:a(E)})]}),W&&e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2 cursor-pointer",onClick:()=>v(o=>!o),children:[e.jsx(As,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{children:"Score Details"}),e.jsxs("span",{className:"ml-2 text-xs text-blue-500",children:["[",i?"Hide":"Show","]"]})]})}),i&&e.jsx(L,{children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs bg-gray-50 p-2 rounded overflow-x-auto",children:JSON.stringify(W,null,2)})})]}),P&&e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2 cursor-pointer",onClick:()=>N(o=>!o),children:[e.jsx(He,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Performance Metrics"}),e.jsxs("span",{className:"ml-2 text-xs text-blue-500",children:["[",m?"Hide":"Show","]"]})]})}),m&&e.jsx(L,{children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs bg-gray-50 p-2 rounded overflow-x-auto",children:JSON.stringify(P,null,2)})})]})]})}const j={home_purchase:"Home Purchase Loan",refinance:"Refinance Loan",home_equity:"Home Equity Loan (HEL)",heloc:"Home Equity Line of Credit (HELOC)",construction:"Construction Loan",new_car:"New Car Loan",used_car:"Used Car Loan",auto_refinance:"Auto Refinance",lease_buyout:"Lease Buyout Loan",federal_student:"Federal Student Loan",private_student:"Private Student Loan",student_refinance:"Student Loan Refinance",credit_card:"Credit Card",store_card:"Store/Retail Card",charge_card:"Charge Card",secured_card:"Secured Credit Card",personal_unsecured:"Unsecured Personal Loan",personal_secured:"Secured Personal Loan",debt_consolidation:"Debt Consolidation",medical_loan:"Medical Loan",wedding_loan:"Wedding or Vacation Loan",emergency_loan:"Emergency Loan",business_term:"Term Business Loan",business_line:"Line of Credit",sba_loan:"SBA or Government-backed Loan",equipment_finance:"Equipment Financing",invoice_finance:"Invoice Financing",microfinance:"Microfinance Loan",bnpl:"Buy Now, Pay Later (BNPL)",installment_retail:"Installment Purchase Loan",mobile_loan:"Mobile Loan",crop_loan:"Crop Loan",livestock_loan:"Livestock Loan",agri_equipment:"Agricultural Equipment Loan",seasonal_loan:"Seasonal Working Capital"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5 text-blue-600"}),"Complete Lending Decision Analysis"]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Decision Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Decision:"}),e.jsx(Q,{variant:s.decision==="Approve"?"default":s.decision==="Reject"?"destructive":"secondary",children:s.decision||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Score:"}),e.jsx("span",{className:"font-medium",children:s.score||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Classification:"}),e.jsx("span",{className:"font-medium",children:s.classification||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Engine Version:"}),e.jsx("span",{className:"font-medium",children:s.engineVersion||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Timestamp:"}),e.jsx("span",{className:"font-medium text-xs",children:r(s.timestamp)})]}),s.loanType&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Loan Type:"}),e.jsx("span",{className:"font-medium",children:j[s.loanType]||s.loanType})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Risk Assessment"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk Tier:"}),e.jsx("span",{className:"font-medium",children:s.riskTier||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk Label:"}),e.jsx("span",{className:"font-medium",children:s.riskTierLabel||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Default Risk:"}),e.jsx("span",{className:"font-medium",children:s.defaultRiskEstimate||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DTI Ratio:"}),e.jsx("span",{className:"font-medium",children:typeof s.dti=="number"?`${(s.dti*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DTI Rating:"}),e.jsx("span",{className:"font-medium",children:s.dtiRating||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Customer Profile"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Employment:"}),e.jsx("span",{className:"font-medium",children:((b=s.customerProfile)==null?void 0:b.employmentStatus)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active Loans:"}),e.jsx("span",{className:"font-medium",children:((x=s.customerProfile)==null?void 0:x.activeLoans)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Delinquency:"}),e.jsx("span",{className:"font-medium",children:((g=s.customerProfile)==null?void 0:g.lastDelinquency)==="N/A"?"N/A":`${(c=s.customerProfile)==null?void 0:c.lastDelinquency} months ago`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Manual Override:"}),e.jsx("span",{className:"font-medium",children:s.isManual?"Yes":"No"})]}),s.rejectionCode&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rejection Code:"}),e.jsx("span",{className:"font-medium text-red-600",children:s.rejectionCode})]})]})]})]})})]}),s.scoringDetails&&e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-purple-600"}),"Scoring Engine Configuration"]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Engine Settings"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Recession Mode:"}),e.jsx(Q,{variant:s.scoringDetails.recessionMode?"destructive":"default",children:s.scoringDetails.recessionMode?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"AI Enabled:"}),e.jsx(Q,{variant:s.scoringDetails.aiEnabled?"default":"secondary",children:s.scoringDetails.aiEnabled?"Yes":"No"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Risk Flags"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.riskFlags&&s.riskFlags.length>0?s.riskFlags.map((R,n)=>e.jsx(Q,{variant:"outline",className:"text-red-600 border-red-300",children:R},n)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No risk flags"})})]})]})})]}),s.reasons&&s.reasons.length>0&&e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5 text-green-600"}),"Decision Reasoning"]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-2",children:s.reasons.map((R,n)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-green-600 mt-0.5",children:"â€¢"}),e.jsx("span",{className:"text-sm",children:R})]},n))})})]})]})},_a=()=>{var f,k,E,W,P,o,T,w,I,F,G,H,V,X,Z,O,ae,re,ee,ne,de,Pe,je,M,q,ie,me,fe,os,Re,ds,qe;const[s,t]=l.useState(null),[r,a]=l.useState(!0),[i,v]=l.useState(!1),[m,N]=l.useState("engines"),[j,b]=l.useState([]),{toast:x}=Ts();l.useEffect(()=>{g()},[]);const g=async()=>{try{a(!0);const d=await K.get("/partner-banks/my/complete-config");t(d.data.config),b([])}catch(d){console.error("Failed to load bank config:",d),x({title:"Error",description:"Failed to load bank configuration",variant:"destructive"})}finally{a(!1)}},c=async()=>{try{v(!0);const d=R(s);if(d.length>0){b(d),x({title:"Validation Error",description:`Configuration has ${d.length} validation errors`,variant:"destructive"});return}const D=[];s.engineConfig&&D.push(K.patch("/partner-banks/my/engine-config",{engineConfig:s.engineConfig})),s.lendingPolicy&&D.push(K.patch("/partner-banks/my/lending-policy",{lendingPolicy:s.lendingPolicy})),s.accessControls&&D.push(K.patch("/partner-banks/my/access-controls",{accessControls:s.accessControls})),s.branding&&D.push(K.patch("/partner-banks/my/branding",{branding:s.branding})),await Promise.all(D),x({title:"Success",description:"Bank configuration saved successfully"}),b([])}catch(d){console.error("Failed to save config:",d),x({title:"Error",description:"Failed to save bank configuration",variant:"destructive"})}finally{v(!1)}},R=d=>{var se,ke,ge,te,le;const D=[];if((ke=(se=d.engineConfig)==null?void 0:se.engine1)!=null&&ke.scoringWeights){const pe=d.engineConfig.engine1.scoringWeights,ve=Object.values(pe).reduce((xe,Ne)=>xe+Ne,0);Math.abs(ve-100)>1&&D.push(`Engine1 scoring weights must sum to 100 (current: ${ve})`)}if((te=(ge=d.engineConfig)==null?void 0:ge.engine2)!=null&&te.weights){const pe=d.engineConfig.engine2.weights,ve=Object.values(pe).reduce((xe,Ne)=>xe+Ne,0);Math.abs(ve-100)>1&&D.push(`Engine2 weights must sum to 100 (current: ${ve})`)}if((le=d.lendingPolicy)!=null&&le.interestRateRules){const pe=d.lendingPolicy.interestRateRules;pe.baseRate>pe.maxRate&&D.push("Base rate cannot be higher than max rate")}return D},n=(d,D,se,ke)=>{t(ge=>{var te;return{...ge,[d]:{...ge[d],[D]:{...(te=ge[d])==null?void 0:te[D],[se]:ke}}}})};return r?e.jsx(C,{children:e.jsxs(L,{className:"flex items-center justify-center p-6",children:[e.jsx(ns,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading bank configuration..."})]})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Bank Configuration"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure your bank's scoring engines, lending policies, and system settings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{variant:"outline",onClick:g,disabled:i,children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(J,{onClick:c,disabled:i,children:[i?e.jsx(ns,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]}),j.length>0&&e.jsxs(ks,{variant:"destructive",children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsxs(Ss,{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Configuration Validation Errors:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:j.map((d,D)=>e.jsx("li",{children:d},D))})]})]}),e.jsxs(dt,{value:m,onValueChange:N,className:"space-y-4",children:[e.jsxs(mt,{className:"grid w-full grid-cols-5",children:[e.jsxs(he,{value:"engines",className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-4 w-4"}),"Engines"]}),e.jsxs(he,{value:"lending",className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"Lending"]}),e.jsxs(he,{value:"access",className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Access"]}),e.jsxs(he,{value:"branding",className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-4 w-4"}),"Branding"]}),e.jsxs(he,{value:"legacy",className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Legacy"]})]}),e.jsx(ue,{value:"engines",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5"}),"Engine 1: Credit-Based Scoring"]}),e.jsx(Ce,{children:"Configure weights, penalties, and bonuses for credit-based scoring"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"Scoring Weights (%)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Object.entries(((k=(f=s.engineConfig)==null?void 0:f.engine1)==null?void 0:k.scoringWeights)||{}).map(([d,D])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs capitalize",children:d.replace(/([A-Z])/g," $1").trim()}),e.jsx(Y,{type:"number",value:D,onChange:se=>n("engineConfig","engine1","scoringWeights",{...s.engineConfig.engine1.scoringWeights,[d]:parseFloat(se.target.value)}),min:"0",max:"100"})]},d))})]}),e.jsx(ts,{}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"Penalties"}),e.jsx("div",{className:"space-y-2 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-xs",children:"Recent Defaults"}),e.jsx(Y,{type:"number",value:((P=(W=(E=s.engineConfig)==null?void 0:E.engine1)==null?void 0:W.penalties)==null?void 0:P.recentDefaults)||0,onChange:d=>n("engineConfig","engine1","penalties",{...s.engineConfig.engine1.penalties,recentDefaults:parseFloat(d.target.value)}),className:"w-20"})]})})]}),e.jsx(ts,{}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"Rejection Rules"}),e.jsx("div",{className:"space-y-2 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-xs",children:"Allow Consecutive Missed Payments"}),e.jsx(Le,{checked:((w=(T=(o=s.engineConfig)==null?void 0:o.engine1)==null?void 0:T.rejectionRules)==null?void 0:w.allowConsecutiveMissedPayments)||!1,onCheckedChange:d=>n("engineConfig","engine1","rejectionRules",{...s.engineConfig.engine1.rejectionRules,allowConsecutiveMissedPayments:d})})]})})]})]})]}),e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5"}),"Engine 2: 5 Cs Creditworthiness"]}),e.jsx(Ce,{children:"Configure weights for Capacity, Capital, Collateral, Conditions, and Character"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"5 Cs Weights (%)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:Object.entries(((F=(I=s.engineConfig)==null?void 0:I.engine2)==null?void 0:F.weights)||{}).map(([d,D])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs capitalize",children:d}),e.jsx(Y,{type:"number",value:D,onChange:se=>n("engineConfig","engine2","weights",{...s.engineConfig.engine2.weights,[d]:parseFloat(se.target.value)}),min:"0",max:"100"})]},d))})]}),e.jsx(ts,{}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"Behavioral Thresholds"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-xs",children:"Max DTI"}),e.jsx(Y,{type:"number",step:"0.01",value:((V=(H=(G=s.engineConfig)==null?void 0:G.engine2)==null?void 0:H.behavioralThresholds)==null?void 0:V.maxDTI)||.45,onChange:d=>n("engineConfig","engine2","behavioralThresholds",{...s.engineConfig.engine2.behavioralThresholds,maxDTI:parseFloat(d.target.value)}),className:"w-20"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-xs",children:"Stable Employment Required"}),e.jsx(Le,{checked:((O=(Z=(X=s.engineConfig)==null?void 0:X.engine2)==null?void 0:Z.behavioralThresholds)==null?void 0:O.stableEmploymentRequired)||!1,onCheckedChange:d=>n("engineConfig","engine2","behavioralThresholds",{...s.engineConfig.engine2.behavioralThresholds,stableEmploymentRequired:d})})]})]})]})]})]})]})}),e.jsxs(ue,{value:"lending",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(B,{children:"Base Loan Amounts"}),e.jsx(Ce,{children:"Maximum loan amounts by credit classification"})]}),e.jsx(L,{className:"space-y-4",children:Object.entries(((ae=s.lendingPolicy)==null?void 0:ae.baseLoanAmounts)||{}).map(([d,D])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm capitalize",children:d.replace(/_/g," ")}),e.jsx(Y,{type:"number",value:D,onChange:se=>n("lendingPolicy","baseLoanAmounts",d,parseFloat(se.target.value)),className:"w-32"})]},d))})]}),e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(B,{children:"Interest Rate Rules"}),e.jsx(Ce,{children:"Base rates and adjustments for different risk factors"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Base Rate (%)"}),e.jsx(Y,{type:"number",step:"0.1",value:((ee=(re=s.lendingPolicy)==null?void 0:re.interestRateRules)==null?void 0:ee.baseRate)||12.5,onChange:d=>n("lendingPolicy","interestRateRules","baseRate",parseFloat(d.target.value)),className:"w-24"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Max Rate (%)"}),e.jsx(Y,{type:"number",step:"0.1",value:((de=(ne=s.lendingPolicy)==null?void 0:ne.interestRateRules)==null?void 0:de.maxRate)||35.99,onChange:d=>n("lendingPolicy","interestRateRules","maxRate",parseFloat(d.target.value)),className:"w-24"})]}),e.jsx(ts,{}),e.jsx(A,{className:"text-sm font-medium",children:"Rate Adjustments (%)"}),Object.entries(((je=(Pe=s.lendingPolicy)==null?void 0:Pe.interestRateRules)==null?void 0:je.adjustments)||{}).map(([d,D])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-xs capitalize",children:d.replace(/_/g," ")}),e.jsx(Y,{type:"number",value:D,onChange:se=>n("lendingPolicy","interestRateRules","adjustments",{...s.lendingPolicy.interestRateRules.adjustments,[d]:parseFloat(se.target.value)}),className:"w-20"})]},d))]})]})]}),e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(B,{children:"Additional Settings"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Recession Mode"}),e.jsx(Le,{checked:((M=s.lendingPolicy)==null?void 0:M.recessionMode)||!1,onCheckedChange:d=>n("lendingPolicy","recessionMode",d)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Allow Collateral Override"}),e.jsx(Le,{checked:((q=s.lendingPolicy)==null?void 0:q.allowCollateralOverride)||!1,onCheckedChange:d=>n("lendingPolicy","allowCollateralOverride",d)})]})]})]})]}),e.jsx(ue,{value:"access",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(B,{children:"Access Controls"}),e.jsx(Ce,{children:"Configure system access and permissions"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Can Export Data"}),e.jsx(Le,{checked:((ie=s.accessControls)==null?void 0:ie.canExportData)||!1,onCheckedChange:d=>n("accessControls","canExportData",d)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"API Access Enabled"}),e.jsx(Le,{checked:((me=s.accessControls)==null?void 0:me.apiAccessEnabled)||!1,onCheckedChange:d=>n("accessControls","apiAccessEnabled",d)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Max File Size (MB)"}),e.jsx(Y,{type:"number",value:((fe=s.accessControls)==null?void 0:fe.maxFileSizeMb)||5,onChange:d=>n("accessControls","maxFileSizeMb",parseInt(d.target.value)),className:"w-24"})]})]})]})}),e.jsx(ue,{value:"branding",className:"space-y-6",children:e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(B,{children:"Branding Configuration"}),e.jsx(Ce,{children:"Customize the appearance and localization"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Primary Color"}),e.jsx(Y,{type:"color",value:((os=s.branding)==null?void 0:os.primaryColor)||"#004aad",onChange:d=>n("branding","primaryColor",d.target.value),className:"w-20"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Theme"}),e.jsxs(Be,{value:((Re=s.branding)==null?void 0:Re.theme)||"light",onValueChange:d=>n("branding","theme",d),children:[e.jsx(De,{className:"w-32",children:e.jsx(Ve,{})}),e.jsxs(ze,{children:[e.jsx(y,{value:"light",children:"Light"}),e.jsx(y,{value:"dark",children:"Dark"}),e.jsx(y,{value:"auto",children:"Auto"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Currency"}),e.jsxs(Be,{value:((ds=s.branding)==null?void 0:ds.currency)||"ETB",onValueChange:d=>n("branding","currency",d),children:[e.jsx(De,{className:"w-32",children:e.jsx(Ve,{})}),e.jsxs(ze,{children:[e.jsx(y,{value:"ETB",children:"ETB"}),e.jsx(y,{value:"USD",children:"USD"}),e.jsx(y,{value:"EUR",children:"EUR"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm",children:"Language"}),e.jsxs(Be,{value:((qe=s.branding)==null?void 0:qe.language)||"en",onValueChange:d=>n("branding","language",d),children:[e.jsx(De,{className:"w-32",children:e.jsx(Ve,{})}),e.jsxs(ze,{children:[e.jsx(y,{value:"en",children:"English"}),e.jsx(y,{value:"am",children:"Amharic"})]})]})]})]})]})}),e.jsxs(ue,{value:"legacy",className:"space-y-6",children:[e.jsxs(ks,{children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx(Ss,{children:"This tab shows the legacy lending configuration for backward compatibility. Consider migrating to the new engine-based configuration above."})]}),e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(B,{children:"Legacy Lending Configuration"}),e.jsx(Ce,{children:"Original lending configuration (read-only)"})]}),e.jsx(L,{children:e.jsx("pre",{className:"text-xs bg-muted p-4 rounded overflow-auto max-h-96",children:JSON.stringify(s.legacyConfig,null,2)})})]})]})]})]}):e.jsx(C,{children:e.jsx(L,{className:"p-6",children:e.jsxs(ks,{children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx(Ss,{children:"Bank configuration not found. Please contact your administrator."})]})})})},Ia=({manualDecision:s,handleManualDecision:t,setIsEditingDecision:r,saveManualDecision:a,recalcLoading:i,hasCollateral:v,setHasCollateral:m,collateralValue:N,setCollateralValue:j,recalculateWithCollateral:b,maxLoanAmount:x})=>{var R,n;const g=Number(s.amount),c=s.decision==="Approve"&&x&&g>x;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"decision-type",children:"Decision Type"}),e.jsxs(Be,{value:s.decision,onValueChange:f=>t("decision",f),children:[e.jsx(De,{className:"w-full",children:e.jsx(Ve,{placeholder:"Select decision type"})}),e.jsxs(ze,{children:[e.jsx(y,{value:"Approve",children:"Approve"}),e.jsx(y,{value:"Reject",children:"Reject"}),e.jsx(y,{value:"Hold",children:"Hold"}),e.jsx(y,{value:"Review",children:"Review"})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{type:"button",onClick:()=>t("flagForReview",!s.flagForReview),className:"flex items-center gap-2 p-2 rounded border hover:bg-gray-50",children:[s.flagForReview?e.jsx(ma,{className:"h-4 w-4 text-blue-600"}):e.jsx(Ca,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"Flag for Manual Review"})]})}),s.flagForReview&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"review-note",children:"Review Note"}),e.jsx(rs,{id:"review-note",placeholder:"Enter reason for manual review...",value:s.reviewNote,onChange:f=>t("reviewNote",f.target.value),className:"mt-1"})]}),s.decision==="Reject"&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"rejection-reason",children:"Custom Rejection Reason"}),e.jsx(rs,{id:"rejection-reason",placeholder:"Enter custom rejection reason...",value:s.rejectionReason,onChange:f=>t("rejectionReason",f.target.value),className:"mt-1"})]}),s.decision==="Approve"&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"loan-type",children:"Loan Type"}),e.jsxs(Be,{value:s.loanType||"",onValueChange:f=>t("loanType",f),children:[e.jsx(De,{className:"w-full",children:e.jsx(Ve,{placeholder:"Select loan type"})}),e.jsxs(ze,{className:"max-h-72 overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸ  Mortgage Loans"}),e.jsx(y,{value:"home_purchase",children:"Home Purchase Loan"}),e.jsx(y,{value:"refinance",children:"Refinance Loan"}),e.jsx(y,{value:"home_equity",children:"Home Equity Loan (HEL)"}),e.jsx(y,{value:"heloc",children:"Home Equity Line of Credit (HELOC)"}),e.jsx(y,{value:"construction",children:"Construction Loan"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸš— Auto Loans"}),e.jsx(y,{value:"new_car",children:"New Car Loan"}),e.jsx(y,{value:"used_car",children:"Used Car Loan"}),e.jsx(y,{value:"auto_refinance",children:"Auto Refinance"}),e.jsx(y,{value:"lease_buyout",children:"Lease Buyout Loan"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸŽ“ Student Loans"}),e.jsx(y,{value:"federal_student",children:"Federal Student Loan"}),e.jsx(y,{value:"private_student",children:"Private Student Loan"}),e.jsx(y,{value:"student_refinance",children:"Student Loan Refinance"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸ’³ Credit / Revolving"}),e.jsx(y,{value:"credit_card",children:"Credit Card"}),e.jsx(y,{value:"store_card",children:"Store/Retail Card"}),e.jsx(y,{value:"charge_card",children:"Charge Card"}),e.jsx(y,{value:"secured_card",children:"Secured Credit Card"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸ§¾ Personal Loans"}),e.jsx(y,{value:"personal_unsecured",children:"Unsecured Personal Loan"}),e.jsx(y,{value:"personal_secured",children:"Secured Personal Loan"}),e.jsx(y,{value:"debt_consolidation",children:"Debt Consolidation"}),e.jsx(y,{value:"medical_loan",children:"Medical Loan"}),e.jsx(y,{value:"wedding_loan",children:"Wedding or Vacation Loan"}),e.jsx(y,{value:"emergency_loan",children:"Emergency Loan"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸ¢ Business Loans"}),e.jsx(y,{value:"business_term",children:"Term Business Loan"}),e.jsx(y,{value:"business_line",children:"Line of Credit"}),e.jsx(y,{value:"sba_loan",children:"SBA or Government-backed Loan"}),e.jsx(y,{value:"equipment_finance",children:"Equipment Financing"}),e.jsx(y,{value:"invoice_finance",children:"Invoice Financing"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸŒ Microfinance & Consumer"}),e.jsx(y,{value:"microfinance",children:"Microfinance Loan"}),e.jsx(y,{value:"bnpl",children:"Buy Now, Pay Later (BNPL)"}),e.jsx(y,{value:"installment_retail",children:"Installment Purchase Loan"}),e.jsx(y,{value:"mobile_loan",children:"Mobile Loan"})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"ðŸ‘¨â€ðŸŒ¾ Agricultural Loans"}),e.jsx(y,{value:"crop_loan",children:"Crop Loan"}),e.jsx(y,{value:"livestock_loan",children:"Livestock Loan"}),e.jsx(y,{value:"agri_equipment",children:"Agricultural Equipment Loan"}),e.jsx(y,{value:"seasonal_loan",children:"Seasonal Working Capital"})]})]})]})]}),s.decision==="Approve"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Loan Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"loan-amount",children:"Loan Amount"}),e.jsx(Y,{id:"loan-amount",type:"number",placeholder:"Enter amount",value:s.amount,onChange:f=>t("amount",f.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"loan-term",children:"Term (months)"}),e.jsx(Y,{id:"loan-term",type:"number",placeholder:"Enter term",value:s.term,onChange:f=>t("term",f.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"interest-rate",children:"Interest Rate (%)"}),e.jsx(Y,{id:"interest-rate",type:"number",step:"0.1",placeholder:"Enter rate",value:s.interestRate,onChange:f=>t("interestRate",f.target.value),className:"mt-1"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Collateral Options"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"collateral-toggle",checked:v,onCheckedChange:m}),e.jsx(A,{htmlFor:"collateral-toggle",children:"Borrower has collateral"})]}),v&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"collateral-value",children:"Collateral Value ($)"}),e.jsx(Y,{id:"collateral-value",type:"number",placeholder:"Enter collateral value",value:N,onChange:f=>j(Number(f.target.value)),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral can increase the maximum loan amount by up to 70% of its value."})]}),e.jsxs(J,{type:"button",variant:"outline",onClick:b,disabled:i,className:"flex items-center gap-2",children:[i?e.jsx(Fs,{className:"h-4 w-4 animate-spin"}):e.jsx(ns,{className:"h-4 w-4"}),"Recalculate with Collateral"]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"decision-notes",children:"Decision Notes"}),e.jsx(rs,{id:"decision-notes",placeholder:"Enter additional notes about this decision...",value:s.notes,onChange:f=>t("notes",f.target.value),className:"mt-1"})]}),s.decision==="Approve"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:["âœï¸ Edit Terms ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(Max: $",((R=x==null?void 0:x.toLocaleString)==null?void 0:R.call(x))||"N/A",")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"loan-amount",children:"Loan Amount"}),e.jsx(Y,{id:"loan-amount",type:"number",placeholder:"Enter amount",value:s.amount,onChange:f=>t("amount",f.target.value),className:"mt-1",min:0,max:x||void 0}),c&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Amount cannot exceed $",((n=x==null?void 0:x.toLocaleString)==null?void 0:n.call(x))||"N/A"," (max offer)"]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"loan-term",children:"Term (months)"}),e.jsx(Y,{id:"loan-term",type:"number",placeholder:"Enter term",value:s.term,onChange:f=>t("term",f.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"interest-rate",children:"Interest Rate (%)"}),e.jsx(Y,{id:"interest-rate",type:"number",step:"0.1",placeholder:"Enter rate",value:s.interestRate,onChange:f=>t("interestRate",f.target.value),className:"mt-1"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(J,{variant:"outline",size:"sm",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(J,{size:"sm",onClick:a,className:"flex items-center gap-2",disabled:c,children:[e.jsx(_s,{className:"h-4 w-4"}),"Save Decision"]})]})]})},$a=({showRegister:s,setShowRegister:t,toast:r})=>e.jsx(xa,{open:s,onCancel:()=>t(!1),footer:null,title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Register New User"})]}),width:600,destroyOnHidden:!0,className:"register-modal",children:e.jsx(ja,{onSuccess:a=>{t(!1),r&&r({title:"User Registered Successfully",description:`New user ${(a==null?void 0:a.email)||"has been created"} and is ready for credit assessment.`,variant:"success",duration:5e3})},onClose:()=>t(!1),isAdmin:!1})});let hs=null;const nt=async(s,t,r,a,i,v)=>{var m,N;if(!s.trim()){t([]);return}try{r(!0),hs&&hs.abort(),hs=new AbortController;const j=await K.get(`/lenders/search-borrowers?search=${encodeURIComponent(s)}`,{signal:hs.signal}),b=Array.isArray(j.data.data)?j.data.data:[];t(b)}catch(j){if((j==null?void 0:j.code)==="ERR_CANCELED"||(j==null?void 0:j.name)==="CanceledError"||(j==null?void 0:j.message)==="canceled")return;console.error("Error searching users:",j),((m=j.response)==null?void 0:m.status)===401||((N=j.response)==null?void 0:N.status)===403?(a({title:"Session expired",description:"Please log in again",variant:"destructive"}),i(),v("/login")):a({title:"Error",description:"Failed to search users",variant:"destructive"})}finally{r(!1)}},Ba=async(s,t)=>{var r;try{const i=((r=(await K.get("/lenders/recent-decisions?limit=100")).data.data)==null?void 0:r.decisions)||[],v=i.filter(b=>{var x;return((x=b.lendingDecision)==null?void 0:x.decision)==="Approve"}).length,m=i.filter(b=>{var x;return((x=b.lendingDecision)==null?void 0:x.decision)==="Review"}).length,N=i.filter(b=>{var x;return((x=b.lendingDecision)==null?void 0:x.decision)==="Reject"}).length,j={low:i.filter(b=>{var x,g;return(((g=(x=b.creditScore)==null?void 0:x.fico)==null?void 0:g.score)||0)>=740}).length,medium:i.filter(b=>{var x,g,c,R;return(((g=(x=b.creditScore)==null?void 0:x.fico)==null?void 0:g.score)||0)>=670&&(((R=(c=b.creditScore)==null?void 0:c.fico)==null?void 0:R.score)||0)<740}).length,high:i.filter(b=>{var x,g;return(((g=(x=b.creditScore)==null?void 0:x.fico)==null?void 0:g.score)||0)<670}).length};s({approvedLoans:v,pendingLoans:m,rejectedLoans:N,avgDecisionTime:"â”€",riskBreakdown:j})}catch{s({approvedLoans:0,pendingLoans:0,rejectedLoans:0,avgDecisionTime:"0m",riskBreakdown:{low:0,medium:0,high:0}}),t&&t({title:"Error",description:"Failed to fetch dashboard metrics",variant:"destructive"})}},Da=async()=>{var s;try{return((s=(await K.get("/lenders/recent-decisions?limit=5")).data.data)==null?void 0:s.decisions)||[]}catch{return[]}},Va=async(s,t)=>{try{const r=[],a=s.filter(i=>{var v,m;return(((m=(v=i.creditScore)==null?void 0:v.fico)==null?void 0:m.score)||0)<670}).length;a>2&&r.push({type:"critical",title:"High Risk Applications",description:`${a} high-risk applications in recent decisions`,time:"2 hours ago"}),t(r)}catch{t([])}};var gt=["PageUp","PageDown"],jt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ft={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Oe="Slider",[Cs,za,Ha]=Xt(Oe),[pt,vn]=Gt(Oe,[Ha]),[Ua,Ns]=pt(Oe),vt=l.forwardRef((s,t)=>{const{name:r,min:a=0,max:i=100,step:v=1,orientation:m="horizontal",disabled:N=!1,minStepsBetweenThumbs:j=0,defaultValue:b=[a],value:x,onValueChange:g=()=>{},onValueCommit:c=()=>{},inverted:R=!1,form:n,...f}=s,k=l.useRef(new Set),E=l.useRef(0),P=m==="horizontal"?Oa:qa,[o=[],T]=Yt({prop:x,defaultProp:b,onChange:V=>{var Z;(Z=[...k.current][E.current])==null||Z.focus(),g(V)}}),w=l.useRef(o);function I(V){const X=Ga(o,V);H(V,X)}function F(V){H(V,E.current)}function G(){const V=w.current[E.current];o[E.current]!==V&&c(o)}function H(V,X,{commit:Z}={commit:!1}){const O=en(v),ae=sn(Math.round((V-a)/v)*v+a,O),re=ct(ae,[a,i]);T((ee=[])=>{const ne=Wa(ee,re,X);if(Za(ne,j*v)){E.current=ne.indexOf(re);const de=String(ne)!==String(ee);return de&&Z&&c(ne),de?ne:ee}else return ee})}return e.jsx(Ua,{scope:s.__scopeSlider,name:r,disabled:N,min:a,max:i,valueIndexToChangeRef:E,thumbs:k.current,values:o,orientation:m,form:n,children:e.jsx(Cs.Provider,{scope:s.__scopeSlider,children:e.jsx(Cs.Slot,{scope:s.__scopeSlider,children:e.jsx(P,{"aria-disabled":N,"data-disabled":N?"":void 0,...f,ref:t,onPointerDown:$e(f.onPointerDown,()=>{N||(w.current=o)}),min:a,max:i,inverted:R,onSlideStart:N?void 0:I,onSlideMove:N?void 0:F,onSlideEnd:N?void 0:G,onHomeKeyDown:()=>!N&&H(a,0,{commit:!0}),onEndKeyDown:()=>!N&&H(i,o.length-1,{commit:!0}),onStepKeyDown:({event:V,direction:X})=>{if(!N){const ae=gt.includes(V.key)||V.shiftKey&&jt.includes(V.key)?10:1,re=E.current,ee=o[re],ne=v*ae*X;H(ee+ne,re,{commit:!0})}}})})})})});vt.displayName=Oe;var[Nt,bt]=pt(Oe,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Oa=l.forwardRef((s,t)=>{const{min:r,max:a,dir:i,inverted:v,onSlideStart:m,onSlideMove:N,onSlideEnd:j,onStepKeyDown:b,...x}=s,[g,c]=l.useState(null),R=Ue(t,P=>c(P)),n=l.useRef(void 0),f=aa(i),k=f==="ltr",E=k&&!v||!k&&v;function W(P){const o=n.current||g.getBoundingClientRect(),T=[0,o.width],I=$s(T,E?[r,a]:[a,r]);return n.current=o,I(P-o.left)}return e.jsx(Nt,{scope:s.__scopeSlider,startEdge:E?"left":"right",endEdge:E?"right":"left",direction:E?1:-1,size:"width",children:e.jsx(yt,{dir:f,"data-orientation":"horizontal",...x,ref:R,style:{...x.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:P=>{const o=W(P.clientX);m==null||m(o)},onSlideMove:P=>{const o=W(P.clientX);N==null||N(o)},onSlideEnd:()=>{n.current=void 0,j==null||j()},onStepKeyDown:P=>{const T=ft[E?"from-left":"from-right"].includes(P.key);b==null||b({event:P,direction:T?-1:1})}})})}),qa=l.forwardRef((s,t)=>{const{min:r,max:a,inverted:i,onSlideStart:v,onSlideMove:m,onSlideEnd:N,onStepKeyDown:j,...b}=s,x=l.useRef(null),g=Ue(t,x),c=l.useRef(void 0),R=!i;function n(f){const k=c.current||x.current.getBoundingClientRect(),E=[0,k.height],P=$s(E,R?[a,r]:[r,a]);return c.current=k,P(f-k.top)}return e.jsx(Nt,{scope:s.__scopeSlider,startEdge:R?"bottom":"top",endEdge:R?"top":"bottom",size:"height",direction:R?1:-1,children:e.jsx(yt,{"data-orientation":"vertical",...b,ref:g,style:{...b.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const k=n(f.clientY);v==null||v(k)},onSlideMove:f=>{const k=n(f.clientY);m==null||m(k)},onSlideEnd:()=>{c.current=void 0,N==null||N()},onStepKeyDown:f=>{const E=ft[R?"from-bottom":"from-top"].includes(f.key);j==null||j({event:f,direction:E?-1:1})}})})}),yt=l.forwardRef((s,t)=>{const{__scopeSlider:r,onSlideStart:a,onSlideMove:i,onSlideEnd:v,onHomeKeyDown:m,onEndKeyDown:N,onStepKeyDown:j,...b}=s,x=Ns(Oe,r);return e.jsx(cs.span,{...b,ref:t,onKeyDown:$e(s.onKeyDown,g=>{g.key==="Home"?(m(g),g.preventDefault()):g.key==="End"?(N(g),g.preventDefault()):gt.concat(jt).includes(g.key)&&(j(g),g.preventDefault())}),onPointerDown:$e(s.onPointerDown,g=>{const c=g.target;c.setPointerCapture(g.pointerId),g.preventDefault(),x.thumbs.has(c)?c.focus():a(g)}),onPointerMove:$e(s.onPointerMove,g=>{g.target.hasPointerCapture(g.pointerId)&&i(g)}),onPointerUp:$e(s.onPointerUp,g=>{const c=g.target;c.hasPointerCapture(g.pointerId)&&(c.releasePointerCapture(g.pointerId),v(g))})})}),wt="SliderTrack",Rt=l.forwardRef((s,t)=>{const{__scopeSlider:r,...a}=s,i=Ns(wt,r);return e.jsx(cs.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...a,ref:t})});Rt.displayName=wt;var Ls="SliderRange",kt=l.forwardRef((s,t)=>{const{__scopeSlider:r,...a}=s,i=Ns(Ls,r),v=bt(Ls,r),m=l.useRef(null),N=Ue(t,m),j=i.values.length,b=i.values.map(c=>Ct(c,i.min,i.max)),x=j>1?Math.min(...b):0,g=100-Math.max(...b);return e.jsx(cs.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...a,ref:N,style:{...s.style,[v.startEdge]:x+"%",[v.endEdge]:g+"%"}})});kt.displayName=Ls;var Es="SliderThumb",St=l.forwardRef((s,t)=>{const r=za(s.__scopeSlider),[a,i]=l.useState(null),v=Ue(t,N=>i(N)),m=l.useMemo(()=>a?r().findIndex(N=>N.ref.current===a):-1,[r,a]);return e.jsx(Ka,{...s,ref:v,index:m})}),Ka=l.forwardRef((s,t)=>{const{__scopeSlider:r,index:a,name:i,...v}=s,m=Ns(Es,r),N=bt(Es,r),[j,b]=l.useState(null),x=Ue(t,W=>b(W)),g=j?m.form||!!j.closest("form"):!0,c=na(j),R=m.values[a],n=R===void 0?0:Ct(R,m.min,m.max),f=Ya(a,m.values.length),k=c==null?void 0:c[N.size],E=k?Xa(k,n,N.direction):0;return l.useEffect(()=>{if(j)return m.thumbs.add(j),()=>{m.thumbs.delete(j)}},[j,m.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[N.startEdge]:`calc(${n}% + ${E}px)`},children:[e.jsx(Cs.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(cs.span,{role:"slider","aria-label":s["aria-label"]||f,"aria-valuemin":m.min,"aria-valuenow":R,"aria-valuemax":m.max,"aria-orientation":m.orientation,"data-orientation":m.orientation,"data-disabled":m.disabled?"":void 0,tabIndex:m.disabled?void 0:0,...v,ref:x,style:R===void 0?{display:"none"}:s.style,onFocus:$e(s.onFocus,()=>{m.valueIndexToChangeRef.current=a})})}),g&&e.jsx(At,{name:i??(m.name?m.name+(m.values.length>1?"[]":""):void 0),form:m.form,value:R},a)]})});St.displayName=Es;var Ja="RadioBubbleInput",At=l.forwardRef(({__scopeSlider:s,value:t,...r},a)=>{const i=l.useRef(null),v=Ue(i,a),m=ra(t);return l.useEffect(()=>{const N=i.current;if(!N)return;const j=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(j,"value").set;if(m!==t&&x){const g=new Event("input",{bubbles:!0});x.call(N,t),N.dispatchEvent(g)}},[m,t]),e.jsx(cs.input,{style:{display:"none"},...r,ref:v,defaultValue:t})});At.displayName=Ja;function Wa(s=[],t,r){const a=[...s];return a[r]=t,a.sort((i,v)=>i-v)}function Ct(s,t,r){const v=100/(r-t)*(s-t);return ct(v,[0,100])}function Ya(s,t){return t>2?`Value ${s+1} of ${t}`:t===2?["Minimum","Maximum"][s]:void 0}function Ga(s,t){if(s.length===1)return 0;const r=s.map(i=>Math.abs(i-t)),a=Math.min(...r);return r.indexOf(a)}function Xa(s,t,r){const a=s/2,v=$s([0,50],[0,a]);return(a-v(t)*r)*r}function Qa(s){return s.slice(0,-1).map((t,r)=>s[r+1]-t)}function Za(s,t){if(t>0){const r=Qa(s);return Math.min(...r)>=t}return!0}function $s(s,t){return r=>{if(s[0]===s[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(s[1]-s[0]);return t[0]+a*(r-s[0])}}function en(s){return(String(s).split(".")[1]||"").length}function sn(s,t){const r=Math.pow(10,t);return Math.round(s*r)/r}var Lt=vt,tn=Rt,an=kt,nn=St;const rn=l.forwardRef(({className:s,...t},r)=>e.jsxs(Lt,{ref:r,className:Zs("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(tn,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(an,{className:"absolute h-full bg-primary"})}),e.jsx(nn,{className:Zs("block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50")})]}));rn.displayName=Lt.displayName;const ln=({userCreditData:s,selectedUser:t,closeBorrowerView:r,loadingCreditData:a,startEditingIncome:i,renderDecisionBadge:v})=>{var m,N,j,b,x,g,c,R,n,f,k,E,W,P;return e.jsxs(C,{className:"mb-8 bg-gradient-to-br from-background via-background to-accent/5 border-2 border-border/50 shadow-elegant hover:shadow-glow transition-all duration-500",children:[e.jsx(_,{className:"pb-6 bg-gradient-to-r from-primary/5 via-accent/5 to-secondary/5 rounded-t-lg border-b border-border/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-primary-glow rounded-xl shadow-md",children:e.jsx(us,{className:"h-6 w-6 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-2xl font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"Borrower Snapshot"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Comprehensive credit and risk analysis"})]})]}),e.jsx(J,{variant:"outline",onClick:r,className:"hover:bg-primary hover:text-primary-foreground hover:border-primary transition-all duration-300 shadow-sm hover:shadow-md",children:"Back to Dashboard"})]})}),e.jsx(L,{className:"p-8",children:a?e.jsxs("div",{className:"flex flex-col justify-center items-center py-16",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full blur-xl"})]}),e.jsx("p",{className:"text-muted-foreground mt-4 font-medium",children:"Loading borrower data..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-accent/10 to-secondary/10 rounded-xl border border-border/30",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-primary to-primary-glow rounded-full flex items-center justify-center shadow-lg",children:e.jsx(us,{className:"h-10 w-10 text-primary-foreground"})}),e.jsx("div",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center shadow-md",children:e.jsx(Ee,{className:"h-4 w-4 text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:(t==null?void 0:t.name)||"N/A"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:(t==null?void 0:t.email)||"N/A"}),e.jsx("div",{className:"mt-2",children:v(((m=s.lendingDecision)==null?void 0:m.decision)||"Review","large")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4",children:e.jsxs(C,{className:"h-full bg-gradient-to-br from-background to-accent/5 border-2 border-border/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(_,{className:"text-center pb-4",children:e.jsxs(B,{className:"flex items-center justify-center gap-2 text-xl",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Credit Score"]})}),e.jsx(L,{className:"text-center pb-8",children:e.jsx("div",{className:"flex flex-col items-center",children:(()=>{var G,H;const o=((H=(G=s.creditScore)==null?void 0:G.fico)==null?void 0:H.score)??s.currentScore??null;let T="bg-gradient-to-br from-muted to-muted/80",w="text-muted-foreground",I="N/A",F="ring-muted/30";return typeof o=="number"&&(o>=740?(T="bg-gradient-to-br from-emerald-500 to-emerald-600",w="text-white",I="Excellent",F="ring-emerald-200"):o>=670?(T="bg-gradient-to-br from-blue-500 to-blue-600",w="text-white",I="Good",F="ring-blue-200"):o>=580?(T="bg-gradient-to-br from-amber-400 to-amber-500",w="text-white",I="Fair",F="ring-amber-200"):(T="bg-gradient-to-br from-red-500 to-red-600",w="text-white",I="Poor",F="ring-red-200")),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative w-32 h-32 ${T} rounded-full flex items-center justify-center shadow-xl ring-4 ${F} transform hover:scale-105 transition-all duration-300`,children:[e.jsx("span",{className:`text-4xl font-bold ${w}`,children:o!==null?o:"N/A"}),e.jsx("div",{className:"absolute inset-0 bg-white/10 rounded-full blur-sm"})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:I}),e.jsxs("div",{className:"text-sm text-muted-foreground bg-accent/20 px-3 py-1 rounded-full",children:["Engine: ",s.engine==="default"?"FF Score":s.engine==="creditworthiness"?"TF Score":s.engine||"Unknown",s.engineVersion&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-primary text-primary-foreground rounded text-xs",children:["v",s.engineVersion]})]})]})]})})()})})]})}),e.jsx("div",{className:"lg:col-span-8",children:e.jsxs(C,{className:"h-full bg-gradient-to-br from-background to-secondary/5 border-2 border-border/50 shadow-lg",children:[e.jsx(_,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),"Risk Assessment"]})}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{label:"Risk Tier",value:((N=s.lendingDecision)==null?void 0:N.riskTierLabel)||((j=s.lendingDecision)==null?void 0:j.riskTier)||"N/A",type:"tier"},{label:"Default Risk",value:((b=s.lendingDecision)==null?void 0:b.defaultRiskEstimate)||"N/A",type:"risk"},{label:"Classification",value:((x=s.lendingDecision)==null?void 0:x.classification)||"N/A",type:"classification"},{label:"DTI Ratio",value:(()=>{var I,F,G;const o=((I=s.lendingDecision)==null?void 0:I.dti)??((F=s.scoreResult)==null?void 0:F.dtiRatio)??s.dti,T=H=>typeof H!="number"?"N/A":H<.15?"Excellent":H<.25?"Good":H<.35?"Fair":"Poor",w=((G=s.lendingDecision)==null?void 0:G.dtiRating)||T(o);return typeof o=="number"?`${(o*100).toFixed(1)}% (${w})`:"N/A"})(),type:"dti"}].map((o,T)=>e.jsxs("div",{className:"p-4 bg-gradient-to-br from-accent/10 to-secondary/10 rounded-lg border border-border/30 hover:shadow-md transition-all duration-300",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground mb-2",children:o.label}),e.jsx("div",{className:"flex items-center gap-2",children:(()=>{let w="bg-gradient-to-r from-muted to-muted/80 text-muted-foreground",I=null;return o.type==="tier"&&o.value==="Subprime"?(w="bg-gradient-to-r from-red-500 to-red-600 text-white",I=e.jsx(as,{className:"h-3 w-3"})):o.type==="risk"&&o.value==="High"?(w="bg-gradient-to-r from-red-500 to-red-600 text-white",I=e.jsx(as,{className:"h-3 w-3"})):o.type==="classification"&&o.value==="Good"?(w="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white",I=e.jsx(He,{className:"h-3 w-3"})):o.type==="dti"&&o.value!=="N/A"&&(w="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white",I=e.jsx(gs,{className:"h-3 w-3"})),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium shadow-sm ${w}`,children:[I,o.value]})})()})]},T))})})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ls,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-bold text-foreground",children:"Financial Metrics"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[{title:"Monthly Income",value:s.monthlyIncome!==void 0&&s.monthlyIncome!==null?`$${s.monthlyIncome.toLocaleString()}`:"N/A",editable:!0,icon:ls,color:"emerald"},{title:"Total Debt",value:s.totalDebt!==void 0&&s.totalDebt!==null?`$${s.totalDebt.toLocaleString()}`:"N/A",icon:Ie,color:"red"},{title:"DTI Ratio",value:typeof s.dti=="number"&&!isNaN(s.dti)?`${(s.dti*100).toFixed(1)}%`:"N/A",icon:gs,color:"blue"},{title:"Max Loan Amount",value:((g=s.lendingDecision)==null?void 0:g.maxLoanAmount)!==void 0&&((c=s.lendingDecision)==null?void 0:c.maxLoanAmount)!==null?s.lendingDecision.maxLoanAmount>0?`$${s.lendingDecision.maxLoanAmount.toLocaleString()}`:"Not Eligible":"N/A",highlight:!0,icon:gs,color:"primary"},{title:"Suggested Rate",value:((R=s.lendingDecision)==null?void 0:R.suggestedInterestRate)!==void 0&&((n=s.lendingDecision)==null?void 0:n.suggestedInterestRate)!==null?s.lendingDecision.suggestedInterestRate:"N/A",highlight:!0,icon:He,color:"primary"},{title:"Missed Payments",value:s.recentMissedPayments!==void 0&&s.recentMissedPayments!==null?s.recentMissedPayments:0,icon:as,color:"amber"},{title:"Recent Defaults",value:s.recentDefaults!==void 0&&s.recentDefaults!==null?s.recentDefaults:0,icon:as,color:"red"},{title:"Credit Utilization",value:((f=s.creditUtilization)==null?void 0:f.overall)!==void 0&&((k=s.creditUtilization)==null?void 0:k.overall)!==null?`${(s.creditUtilization.overall*100).toFixed(1)}%`:"N/A",icon:Ie,color:"blue"},{title:"Credit Mix",value:s.creditMix!==void 0&&s.creditMix!==null?`${(s.creditMix*100).toFixed(1)}%`:"N/A",icon:Ee,color:"purple"},{title:"Credit Age (months)",value:s.creditAgeMonths!==void 0&&s.creditAgeMonths!==null?s.creditAgeMonths:"N/A",icon:xt,color:"blue"},{title:"Total Accounts",value:s.totalAccounts!==void 0&&s.totalAccounts!==null?s.totalAccounts:"N/A",icon:Ie,color:"blue"},{title:"Open Accounts",value:s.openAccounts!==void 0&&s.openAccounts!==null?s.openAccounts:"N/A",icon:Ie,color:"emerald"},{title:"Collateral Value",value:((E=s.lendingDecision)==null?void 0:E.collateralValue)!==void 0&&((W=s.lendingDecision)==null?void 0:W.collateralValue)!==null?s.lendingDecision.collateralValue>0?`$${s.lendingDecision.collateralValue.toLocaleString()}`:"None":"N/A",highlight:((P=s.lendingDecision)==null?void 0:P.collateralValue)>0,icon:Ee,color:"primary"}].map((o,T)=>e.jsx(C,{className:`group hover:shadow-lg transition-all duration-300 cursor-pointer hover:scale-105 ${o.highlight?"bg-gradient-to-br from-primary/5 via-accent/5 to-secondary/5 border-2 border-primary/20 shadow-md":"bg-gradient-to-br from-background to-accent/5 border border-border/50"}`,children:e.jsxs(L,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl shadow-sm ${o.color==="emerald"?"bg-gradient-to-br from-emerald-100 to-emerald-200 border border-emerald-300":o.color==="red"?"bg-gradient-to-br from-red-100 to-red-200 border border-red-300":o.color==="blue"?"bg-gradient-to-br from-blue-100 to-blue-200 border border-blue-300":o.color==="amber"?"bg-gradient-to-br from-amber-100 to-amber-200 border border-amber-300":o.color==="purple"?"bg-gradient-to-br from-purple-100 to-purple-200 border border-purple-300":o.color==="primary"?"bg-gradient-to-br from-primary/20 to-primary/30 border border-primary/40":"bg-gradient-to-br from-muted to-muted/80 border border-border"}`,children:e.jsx(o.icon,{className:`h-5 w-5 ${o.color==="emerald"?"text-emerald-600":o.color==="red"?"text-red-600":o.color==="blue"?"text-blue-600":o.color==="amber"?"text-amber-600":o.color==="purple"?"text-purple-600":o.color==="primary"?"text-primary":"text-muted-foreground"}`})}),o.editable&&e.jsx(J,{variant:"ghost",size:"sm",onClick:i,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 hover:bg-primary hover:text-primary-foreground",children:e.jsx(Is,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:o.title}),e.jsx("p",{className:`text-lg font-bold ${o.highlight?"text-primary":"text-foreground"}`,children:o.value})]})]})},T))})]})]}):e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"p-6 bg-gradient-to-br from-muted/50 to-accent/10 rounded-xl border border-border/50 inline-block",children:[e.jsx(us,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground font-medium",children:"No credit data available"}),e.jsx("p",{className:"text-sm text-muted-foreground/80 mt-2",children:"Please select a borrower to view their information"})]})})})]})},Nn=({darkMode:s,toggleDarkMode:t})=>{var zs,Hs,Us,Os,qs;const r=Qt(),{toast:a}=Ts(),{logout:i,user:v}=Zt(),[m,N]=l.useState(""),[j,b]=l.useState([]),[x,g]=l.useState(!1),[c,R]=l.useState(null),[n,f]=l.useState(null),[k,E]=l.useState(!1),[W,P]=l.useState(null),[o,T]=l.useState(!1),[w,I]=l.useState({decision:"",notes:"",amount:"",term:"",interestRate:"",rejectionReason:"",flagForReview:!1,reviewNote:"",riskTierOverride:"",overrideJustification:"",loanType:""}),[F,G]=l.useState({approvedLoans:0,pendingLoans:0,rejectedLoans:0,avgDecisionTime:"0m",riskBreakdown:{low:0,medium:0,high:0}}),[H,V]=l.useState([]),[X,Z]=l.useState([]),[O,ae]=l.useState(null),[re,ee]=l.useState(!1),[ne,de]=l.useState(!1),[Pe,je]=l.useState(!1),[M,q]=l.useState(""),[ie,me]=l.useState(!1),[fe,os]=l.useState(!1),[Re,ds]=l.useState(0),[qe,d]=l.useState(!1),[D,se]=l.useState(null),[ke,ge]=l.useState(!1),te=l.useRef(null),le=l.useRef(null),[pe,ve]=l.useState(!1),[xe,Ne]=l.useState({isActive:!1,lastError:null,consecutiveErrors:0,baseInterval:3e4,maxInterval:3e5,currentInterval:3e4});l.useEffect(()=>()=>{te.current&&clearTimeout(te.current)},[]);const Et=l.useCallback(u=>{const p=u.target.value;N(p),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{nt(p,b,g,a,i,r)},500)},[a,i,r]),Tt=l.useCallback(()=>{te.current&&clearTimeout(te.current);const u=m;if(!u){b([]);return}nt(u,b,g,a,i,r)},[m,a,i,r]),ms=l.useCallback(async u=>{var p,S,$,ce,Ae,be,We,Ye,Ge,Xe,Qe,Ze,es,Ks,Js,Ws;if(u)try{E(!0),P(null);const ss=await K.get(`/user/${u}/credit-data`),U=ss.data.data||ss.data;if(!U)throw new Error("No data received from server");const Ys=z=>!!(z&&(z.decision||z.maxLoanAmount||z.suggestedInterestRate||z.loanDetails));let h=U.lendingDecision;Ys(h)||(h=[...Array.isArray(U.lendingDecisionHistory)?U.lendingDecisionHistory:[]].reverse().find(Ys)||h);const ws=()=>{const z=U.scoreResult||{};if(typeof z.dtiRatio=="number")return z.dtiRatio;if(typeof z.dti=="number")return z.dti;if(typeof z.dti=="string"){const oe=parseFloat(z.dti);if(!isNaN(oe))return oe>1?oe/100:oe}return typeof U.dti=="number"?U.dti:typeof(h==null?void 0:h.dti)=="number"?h.dti:void 0},qt={...h,classification:(h==null?void 0:h.classification)||((p=U.scoreResult)==null?void 0:p.classification)||(h==null?void 0:h.riskLabel),dti:ws(),score:(h==null?void 0:h.score)||((S=U.scoreResult)==null?void 0:S.score)||U.currentScore,engineVersion:(h==null?void 0:h.engineVersion)||(($=U.scoreResult)==null?void 0:$.version),...(()=>{var Xs;const z=(h==null?void 0:h.score)??((Xs=U.scoreResult)==null?void 0:Xs.score)??U.currentScore;let oe={};return(!(h!=null&&h.riskTier)||!(h!=null&&h.riskTierLabel)||!(h!=null&&h.defaultRiskEstimate))&&typeof z=="number"&&(z>=800?oe={riskTier:"Low Risk",riskTierLabel:"Prime",defaultRiskEstimate:"Very Low"}:z>=740?oe={riskTier:"Low Risk",riskTierLabel:"Prime",defaultRiskEstimate:"Low"}:z>=670?oe={riskTier:"Moderate Risk",riskTierLabel:"Near Prime",defaultRiskEstimate:"Moderate"}:z>=580?oe={riskTier:"High Risk",riskTierLabel:"Subprime",defaultRiskEstimate:"High"}:oe={riskTier:"Very High Risk",riskTierLabel:"Deep Subprime",defaultRiskEstimate:"Very High"}),oe})(),...(()=>{const z=ws();return!(h!=null&&h.dtiRating)&&typeof z=="number"?{dtiRating:z<=.35?"Low":z<=.45?"Medium":"High"}:{}})(),customerProfile:{...(h==null?void 0:h.customerProfile)||{},employmentStatus:(h==null?void 0:h.customerProfile)&&h.customerProfile.employmentStatus||((Ae=(ce=U.scoreResult)==null?void 0:ce.customerProfile)==null?void 0:Ae.employmentStatus)}},Gs=h?{amount:h.loanDetails&&parseFloat(h.loanDetails.amount)||h.maxLoanAmount||((be=h.offer)==null?void 0:be.maxAmount)||null,interestRate:h.loanDetails&&parseFloat(h.loanDetails.interestRate)||h.suggestedInterestRate||((We=h.offer)==null?void 0:We.interestRate)||null,termMonths:h.loanDetails&&parseInt(h.loanDetails.term)||h.termMonths||h.term||((Ye=h.offer)==null?void 0:Ye.termMonths)||null,monthlyPayment:h.monthlyPayment??((Ge=h.offer)==null?void 0:Ge.monthlyPayment)??null,apr:h.apr??((Xe=h.offer)==null?void 0:Xe.apr)??null,totalInterest:h.totalInterest??((Qe=h.offer)==null?void 0:Qe.totalInterest)??null,maxAmount:h.maxLoanAmount??((Ze=h.offer)==null?void 0:Ze.maxAmount)??null,pricingModel:h.pricingModel,availableTerms:h.availableTerms||((es=h.offer)==null?void 0:es.availableTerms),expirationDate:h.expirationDate}:null;f({userId:u,...U,currentScore:U.currentScore,lendingDecision:qt,engine:U.engine||"default",engineVersion:((Ks=U.scoreResult)==null?void 0:Ks.version)||U.engineVersion,dti:ws()}),Gs&&ae(Gs)}catch(ss){const U=((Ws=(Js=ss.response)==null?void 0:Js.data)==null?void 0:Ws.error)||ss.message||"Failed to load credit data";P(U),a({title:"Error",description:U,variant:"destructive"})}finally{E(!1)}},[K,a]);l.useCallback(async u=>{var p,S;f(null),P(null),ae(null),R(u);try{await ms(u._id)}catch($){a({title:"Error",description:((S=(p=$.response)==null?void 0:p.data)==null?void 0:S.error)||$.message||"Failed to fetch data",variant:"destructive"})}bs("borrower")},[a,ms]);const Pt=l.useCallback(()=>{R(null),f(null),T(!1),I({decision:"",notes:"",amount:"",term:"",interestRate:"",rejectionReason:"",flagForReview:!1,reviewNote:"",riskTierOverride:"",overrideJustification:"",loanType:""}),bs("overview")},[]),[Mt,bs]=l.useState("overview"),Ke=l.useCallback(async()=>{try{await Ba(G,a)}catch{G({approvedLoans:0,pendingLoans:0,rejectedLoans:0,avgDecisionTime:"0m",riskBreakdown:{low:0,medium:0,high:0}}),a({title:"Error",description:"Failed to fetch dashboard metrics",variant:"destructive"})}},[a]),Se=l.useCallback(async()=>{try{const u=await Da();return Z(u),u}catch{return Z([]),a({title:"Error",description:"Failed to fetch recent decisions",variant:"destructive"}),[]}},[a]),Je=l.useCallback(async u=>{try{await Va(u,V)}catch{V([]),a({title:"Error",description:"Failed to fetch alerts",variant:"destructive"})}},[a]),Ft=l.useCallback(async()=>{var u,p;ve(!0);try{await Ke();const S=await Se();await Je(S),a({title:"Refreshed",description:"Latest data has been refreshed",variant:"default"})}catch(S){a({title:"Refresh Failed",description:((p=(u=S.response)==null?void 0:u.data)==null?void 0:p.error)||"Failed to refresh data",variant:"destructive"})}finally{ve(!1)}},[Ke,Se,Je,a]),ys=l.useCallback(async()=>{if(document.visibilityState==="visible")try{await Ke();const u=await Se();await Je(u),Ne(p=>({...p,consecutiveErrors:0,currentInterval:p.baseInterval,lastError:null}))}catch(u){console.warn("Polling error:",u),Ne(p=>{var be;const S=p.consecutiveErrors+1,ce=((be=u.response)==null?void 0:be.status)===429?Math.pow(2,S):S,Ae=Math.min(p.baseInterval*ce,p.maxInterval);return{...p,consecutiveErrors:S,currentInterval:Ae,lastError:u,isActive:S<10}})}},[Ke,Se,Je]),xs=l.useCallback(()=>{Ne(u=>({...u,isActive:!0,consecutiveErrors:0,lastError:null,currentInterval:u.baseInterval}))},[]);l.useEffect(()=>{const u=()=>{document.visibilityState==="visible"&&!xe.isActive&&xs()};return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[xe.isActive,xs]),l.useEffect(()=>{if(!xe.isActive){le.current&&(clearInterval(le.current),le.current=null);return}return ys(),le.current=setInterval(()=>ys(),xe.currentInterval),()=>{le.current&&(clearInterval(le.current),le.current=null)}},[xe.isActive,xe.currentInterval,ys]),l.useEffect(()=>(xs(),()=>{Ne(u=>({...u,isActive:!1}))}),[xs]);const _t=l.useCallback(async()=>{var u,p,S,$;if(!(n!=null&&n.userId)){a({title:"Error",description:"No user selected for decision",variant:"destructive"});return}try{await K.post(`/lenders/save-decision/${n.userId}`,{decision:w.decision,notes:w.notes,isManual:!0,reasons:((u=n==null?void 0:n.lendingDecision)==null?void 0:u.reasons)||[],recommendations:((p=n==null?void 0:n.lendingDecision)==null?void 0:p.recommendations)||[],loanDetails:{amount:w.amount,term:w.term,interestRate:w.interestRate},loanType:w.loanType,rejectionReason:w.rejectionReason,flagForReview:w.flagForReview,reviewNote:w.reviewNote,riskTierOverride:w.riskTierOverride,overrideJustification:w.overrideJustification}),f(ce=>({...ce,lendingDecision:{...ce.lendingDecision,decision:w.decision,isManual:!0,manualNotes:w.notes,loanDetails:{amount:w.amount,term:w.term,interestRate:w.interestRate},loanType:w.loanType,rejectionReason:w.rejectionReason,flagForReview:w.flagForReview,reviewNote:w.reviewNote,riskTierOverride:w.riskTierOverride,overrideJustification:w.overrideJustification}})),T(!1),a({title:"Success",description:"Lending decision saved",variant:"default"}),await Se()}catch(ce){a({title:"Error",description:(($=(S=ce.response)==null?void 0:S.data)==null?void 0:$.error)||"Failed to save decision",variant:"destructive"})}},[w,n,a,Se]),It=l.useCallback(()=>{var u,p,S,$,ce,Ae,be,We,Ye,Ge,Xe,Qe,Ze,es;I({decision:((u=n==null?void 0:n.lendingDecision)==null?void 0:u.decision)||"Review",notes:((p=n==null?void 0:n.lendingDecision)==null?void 0:p.manualNotes)||"",amount:(($=(S=n==null?void 0:n.lendingDecision)==null?void 0:S.loanDetails)==null?void 0:$.amount)||"",term:((Ae=(ce=n==null?void 0:n.lendingDecision)==null?void 0:ce.loanDetails)==null?void 0:Ae.term)||"",interestRate:((We=(be=n==null?void 0:n.lendingDecision)==null?void 0:be.loanDetails)==null?void 0:We.interestRate)||"",rejectionReason:((Ye=n==null?void 0:n.lendingDecision)==null?void 0:Ye.rejectionReason)||"",flagForReview:((Ge=n==null?void 0:n.lendingDecision)==null?void 0:Ge.flagForReview)||!1,reviewNote:((Xe=n==null?void 0:n.lendingDecision)==null?void 0:Xe.reviewNote)||"",riskTierOverride:((Qe=n==null?void 0:n.lendingDecision)==null?void 0:Qe.riskTierOverride)||"",overrideJustification:((Ze=n==null?void 0:n.lendingDecision)==null?void 0:Ze.overrideJustification)||"",loanType:((es=n==null?void 0:n.lendingDecision)==null?void 0:es.loanType)||""}),T(!0)},[n]);l.useCallback(async()=>{var u,p,S;if(c){me(!0);try{const $=await K.post(`/lenders/lending-decision/${c._id}/recalculate`,{monthlyIncome:Number(M)});(u=$.data)!=null&&u.offer&&(ae($.data.offer),a({title:"Loan offer recalculated",description:`New offer based on income $${M}`}))}catch($){a({title:"Error",description:((S=(p=$.response)==null?void 0:p.data)==null?void 0:S.error)||$.message,variant:"destructive"})}finally{me(!1),je(!1)}}},[c,M,a]);const $t=l.useCallback(async()=>{var u,p,S;if(c){me(!0);try{const $=await K.post(`/lenders/lending-decision/${c._id}/recalculate`,{collateralValue:fe?Number(Re):0});(u=$.data)!=null&&u.offer&&(ae($.data.offer),a({title:"Loan offer recalculated",description:fe?`New offer with collateral value $${Re.toLocaleString()}`:"New offer without collateral"}))}catch($){a({title:"Error",description:((S=(p=$.response)==null?void 0:p.data)==null?void 0:S.error)||$.message,variant:"destructive"})}finally{me(!1)}}},[c,fe,Re,a]),Bs=l.useCallback(async()=>{var u,p;if(!(!c||!O)){ee(!0);try{await K.post(`/lenders/save-decision/${c._id}`,{decision:"Approve",notes:"Offer sent to borrower",loanDetails:{amount:O.amount,term:O.termMonths,interestRate:O.interestRate},isManual:!1}),a({title:"Offer sent",description:"Loan offer sent to borrower."})}catch(S){a({title:"Error",description:((p=(u=S.response)==null?void 0:u.data)==null?void 0:p.error)||S.message,variant:"destructive"})}finally{ee(!1)}}},[c,O,a]),Ds=l.useCallback(async()=>{var u,p;if(!(!c||!O)){de(!0);try{await K.post(`/lenders/save-decision/${c._id}`,{decision:"Reject",notes:"Offer declined by lender",isManual:!1}),a({title:"Offer declined",description:"Loan offer declined."})}catch(S){a({title:"Error",description:((p=(u=S.response)==null?void 0:u.data)==null?void 0:p.error)||S.message,variant:"destructive"})}finally{de(!1)}}},[c,O,a]),Bt=l.useCallback(async u=>{var p,S;if(c)try{switch(u){case"approve":await K.post(`/lenders/save-decision/${c._id}`,{decision:"Approve",notes:"Final offer approved by lender",isManual:!0}),a({title:"Offer Approved",description:"Final offer has been approved."});break;case"edit":T(!0),a({title:"Edit Mode",description:"You can now edit the loan offer terms."});break;case"download":a({title:"Download Started",description:"PDF summary is being generated..."});break;case"send":await Bs();break;case"decline":await Ds();break;case"hold":await K.post(`/lenders/save-decision/${c._id}`,{decision:"Hold",notes:"Application put on hold by lender",isManual:!0}),a({title:"Application on Hold",description:"Application has been put on hold."});break;default:break}}catch($){a({title:"Error",description:((S=(p=$.response)==null?void 0:p.data)==null?void 0:S.error)||$.message,variant:"destructive"})}},[c,Bs,Ds,a]);l.useEffect(()=>()=>{te.current&&clearTimeout(te.current),le.current&&clearInterval(le.current)},[]),l.useEffect(()=>{let u=!1;return(async()=>{await Ke();const p=await Se();u||await Je(p)})(),()=>{u=!0}},[]);const Vs=l.useCallback((u,p)=>{I(S=>({...S,[u]:p}))},[]),Dt=l.useCallback(()=>je(!0),[]),Vt=l.useCallback(()=>{d(!0)},[]),zt=l.useCallback(()=>d(!1),[]),Ht=l.useCallback(async u=>{if(d(!1),se(u),c)try{await K.post(`/users/${c._id}/refresh-credit-score`),await ms(c._id)}catch(p){console.warn("Credit score refresh failed:",p)}},[c,K,ms]),Me=F.approvedLoans+F.pendingLoans+F.rejectedLoans,Ut=Me>0?(F.approvedLoans/Me*100).toFixed(1):0,Ot=()=>{const u=[{title:"Approved Loans",value:F.approvedLoans,icon:Ps,color:"emerald",gradient:"bg-gradient-to-r from-emerald-500 to-emerald-700",trend:"+12%",trendUp:!0,description:"Successfully funded"},{title:"Pending Review",value:F.pendingLoans,icon:Ms,color:"amber",gradient:"bg-gradient-to-r from-amber-500 to-amber-700",trend:"-5%",trendUp:!1,description:"Awaiting decision"},{title:"Rejected Applications",value:F.rejectedLoans,icon:vs,color:"red",gradient:"bg-gradient-to-r from-red-500 to-red-700",trend:"-8%",trendUp:!0,description:"Did not meet criteria"},{title:"Avg. Decision Time",value:F.avgDecisionTime,icon:ht,color:"blue",gradient:"bg-gradient-to-r from-blue-500 to-blue-700",trend:"-15%",trendUp:!0,description:"Processing efficiency"}];return e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-indigo-600 to-purple-600 p-8 text-white shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Portfolio Overview"}),e.jsx("p",{className:"text-white/80",children:"Real-time lending metrics and performance"})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-white/20 px-4 py-2 backdrop-blur-sm",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Live"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:Me}),e.jsx("div",{className:"text-white/80 text-sm",children:"Total Applications"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold mb-1",children:[Ut,"%"]}),e.jsx("div",{className:"text-white/80 text-sm",children:"Approval Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"â”€"}),e.jsx("div",{className:"text-white/80 text-sm",children:"Total Funded"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"â”€"}),e.jsx("div",{className:"text-white/80 text-sm",children:"Avg Risk Score"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((p,S)=>e.jsxs(C,{className:"group relative overflow-hidden border-0 bg-card shadow-lg hover:shadow-xl transition-all duration-500 hover:scale-105",children:[e.jsx("div",{className:`absolute inset-0 ${p.gradient} opacity-5 group-hover:opacity-10 transition-opacity duration-500`}),e.jsxs(L,{className:"relative p-6",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsx("div",{className:`rounded-2xl p-3 ${p.gradient} shadow-lg`,children:e.jsx(p.icon,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`flex items-center gap-1 text-xs font-semibold ${p.trendUp?"text-emerald-500":"text-red-500"}`,children:[p.trendUp?e.jsx(He,{className:"h-3 w-3"}):e.jsx(as,{className:"h-3 w-3"}),p.trend]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold text-foreground",children:p.value}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:p.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p.description})]}),p.title.includes("Loans")&&Me>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-1 flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Portfolio %"}),e.jsxs("span",{children:[(p.value/Me*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:`h-full transition-all duration-1000 ease-out ${p.gradient}`,style:{width:`${p.value/Me*100}%`,animationDelay:`${S*100}ms`}})})]})]})]},S))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(C,{className:"border-0 bg-gradient-to-r from-emerald-500 to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium opacity-90",children:"Low Risk Portfolio"}),e.jsxs("div",{className:"text-3xl font-bold",children:[F.riskBreakdown.low,"%"]})]}),e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(Ee,{className:"h-6 w-6"})})]})})}),e.jsx(C,{className:"border-0 bg-gradient-to-r from-blue-500 to-blue-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium opacity-90",children:"Medium Risk Portfolio"}),e.jsxs("div",{className:"text-3xl font-bold",children:[F.riskBreakdown.medium,"%"]})]}),e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(gs,{className:"h-6 w-6"})})]})})}),e.jsx(C,{className:"border-0 bg-gradient-to-r from-purple-500 to-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium opacity-90",children:"High Risk Portfolio"}),e.jsxs("div",{className:"text-3xl font-bold",children:[F.riskBreakdown.high,"%"]})]}),e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(ba,{className:"h-6 w-6"})})]})})})]})]})};return e.jsx(it,{children:e.jsx("div",{className:"min-h-screen bg-background transition-colors duration-300",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx(Ea,{darkMode:s,toggleDarkMode:t,refreshing:pe,pollingState:xe,onRefresh:Ft,onOpenBatchUpload:Vt,onOpenRegister:()=>ge(!0)}),e.jsx(Pa,{searchQuery:m,onSearchChange:Et,onSearch:Tt,users:j,loading:x,onSelectUser:async u=>{R(u),await loadUserCreditData(u),await loadRecentDecisions()}}),e.jsxs(dt,{value:Mt,onValueChange:bs,className:"space-y-6",children:[e.jsxs(mt,{className:"grid grid-cols-5 h-14 rounded-2xl bg-muted/50 p-1 shadow-inner",children:[e.jsxs(he,{value:"overview",className:"rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(he,{value:"borrower",disabled:!c,className:"rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Borrower"]}),e.jsxs(he,{value:"decision",disabled:!c,className:"rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Decision"]}),e.jsxs(he,{value:"config",className:"rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Config"]}),e.jsxs(he,{value:"activity",className:"rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-500 data-[state=active]:to-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-300",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Activity"]})]}),e.jsxs(ue,{value:"overview",className:"space-y-8",children:[Ot(),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(tt,{alerts:H}),e.jsx(at,{recentDecisions:X})]})]}),e.jsx(ue,{value:"borrower",className:"space-y-6",children:c&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(ln,{userCreditData:n,selectedUser:c,closeBorrowerView:Pt,loadingCreditData:k,startEditingIncome:Dt,renderDecisionBadge:ps}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(La,{decision:n==null?void 0:n.lendingDecision,loanOffer:((zs=n==null?void 0:n.lendingDecision)==null?void 0:zs.offer)||O,onDecisionAction:Bt,isLender:!0}),n&&e.jsxs(C,{className:"border-0 bg-card shadow-lg",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(B,{className:"text-xl",children:"Decision Controls"}),!o&&e.jsxs(J,{variant:"outline",size:"sm",onClick:It,className:"border-border hover:bg-muted",children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"Edit Decision"]})]})}),e.jsx(L,{children:o?e.jsx(Ia,{manualDecision:w,handleManualDecision:Vs,setIsEditingDecision:T,saveManualDecision:_t,recalcLoading:ie,hasCollateral:fe,setHasCollateral:os,collateralValue:Re,setCollateralValue:ds,recalculateWithCollateral:$t,maxLoanAmount:((qs=n==null?void 0:n.lendingDecision)==null?void 0:qs.maxOffer)||(O==null?void 0:O.maxOffer)||0}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium",children:"Current Decision:"}),e.jsx(ps,{decision:((Hs=n==null?void 0:n.lendingDecision)==null?void 0:Hs.decision)||"Review"})]}),((Us=n==null?void 0:n.lendingDecision)==null?void 0:Us.manualNotes)&&e.jsxs("div",{className:"rounded-lg bg-muted/50 p-4",children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.lendingDecision.manualNotes})]}),((Os=n==null?void 0:n.lendingDecision)==null?void 0:Os.flagForReview)&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-500 p-3 rounded-lg bg-amber-500/10",children:[e.jsx(ha,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Flagged for Manual Review"})]})]})})]})]}),(n==null?void 0:n.lendingDecision)&&e.jsx(Fa,{lendingDecision:n.lendingDecision}),n&&e.jsx(Ma,{userCreditData:n,isEditingDecision:o,manualDecision:w,handleManualDecision:Vs,user:v})]})}),e.jsx(ue,{value:"decision",className:"space-y-6",children:c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"Decision Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced decision analysis and tools"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-xl font-semibold text-muted-foreground",children:"No borrower selected"}),e.jsx("p",{className:"text-muted-foreground",children:"Select a borrower to view decision details"})]})}),e.jsx(ue,{value:"config",className:"space-y-6",children:e.jsx(_a,{})}),e.jsx(ue,{value:"activity",className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(at,{recentDecisions:X})}),e.jsx("div",{children:e.jsx(tt,{alerts:H})})]})})]}),qe&&e.jsx(ua,{showBatchUpload:qe,handleBatchUploadClose:zt,handleBatchUploadComplete:Ht,toast:a}),ke&&e.jsx($a,{open:ke,onClose:()=>ge(!1)}),D&&e.jsx(ga,{results:D,onClose:()=>se(null)})]})})})};export{Nn as default};
//# sourceMappingURL=LenderDashboard-0rNU206M.js.map

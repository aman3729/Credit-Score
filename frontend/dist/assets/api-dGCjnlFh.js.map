{"version":3,"file":"api-dGCjnlFh.js","sources":["../../src/lib/api.js"],"sourcesContent":["import axios from 'axios';\nimport { toast } from '../hooks/use-toast';\nimport { getCsrfToken, fetchCsrfToken } from '../services/csrfService';\n\n// Create axios instance with base URL\nconst api = axios.create({\n  baseURL: '/api/v1', // Use relative URL to leverage Vite proxy\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: true, // Important for sending cookies with CORS\n  timeout: 10000 // 10 second timeout\n});\n\nlet isRefreshing = false;\nlet failedQueue = [];\n\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\n// Add a request interceptor to attach CSRF token to mutating requests\napi.interceptors.request.use(\n  async (config) => {\n    // Attach CSRF token for mutating requests\n    const method = config.method && config.method.toLowerCase();\n    if ([\"post\", \"put\", \"patch\", \"delete\"].includes(method)) {\n      let csrfToken = getCsrfToken();\n      if (!csrfToken) {\n        csrfToken = await fetchCsrfToken();\n      }\n      if (csrfToken) {\n        config.headers['x-csrf-token'] = csrfToken;\n      }\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// Request interceptor to add auth token to requests\n// Removed Bearer token injection. We rely on httpOnly auth cookies set by the server.\n\n// Response interceptor to handle errors and token refresh\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n    const { response } = error;\n\n    // If error is not 401, reject immediately\n    if (!response || response.status !== 401) {\n      showErrorToast(error);\n      return Promise.reject(error);\n    }\n    // For cookie-based auth, simply redirect to login on 401\n    logoutUser();\n    return Promise.reject(error);\n  }\n);\n\n// Helper function to handle user logout\nconst logoutUser = () => {\n  // Tokens are stored in httpOnly cookies by the server.\n  // Just navigate to login; server will clear cookies on logout endpoint if needed.\n  if (window.location.pathname !== '/login') {\n    window.location.href = '/login';\n  }\n};\n\n// Helper function to show error toasts\nconst showErrorToast = (error) => {\n  const { response } = error;\n  \n  // Don't show toasts for 401 errors (handled by interceptor)\n  if (response && response.status === 401) return;\n  \n  let title = 'Error';\n  let message = 'An unexpected error occurred. Please try again.';\n  \n  if (response) {\n    if (response.data && response.data.message) {\n      message = response.data.message;\n    } else if (response.status === 403) {\n      title = 'Access Denied';\n      message = 'You do not have permission to perform this action.';\n    } else if (response.status === 404) {\n      title = 'Not Found';\n      message = 'The requested resource was not found.';\n    } else if (response.status >= 500) {\n      title = 'Server Error';\n      message = 'A server error occurred. Please try again later.';\n    }\n  } else if (error.message === 'Network Error') {\n    title = 'Network Error';\n    message = 'Unable to connect to the server. Please check your internet connection.';\n  }\n  \n  toast({\n    title,\n    description: message,\n    variant: 'destructive',\n  });\n};\n\n// Export as default\nexport default api;\n\n// Also export as named export for flexibility\nexport { api };\n\n// Mapping Profile API\nexport async function createMappingProfile(profile) {\n  // Update to correct endpoint if needed\n  return await api.post('/schema-mapping/create', profile);\n}\nexport async function getMappingProfiles(partnerId) {\n  // Use the correct backend endpoint for partner mappings\n  return await api.get(`/schema-mapping/partner/${partnerId}`);\n}\nexport async function getMappingProfile(id) {\n  // If a get-by-id endpoint exists, update here; otherwise, remove or adjust as needed\n  return await api.get(`/schema-mapping/${id}`);\n}\nexport async function updateMappingProfile(id, updates) {\n  // If an update endpoint exists, update here; otherwise, remove or adjust as needed\n  return await api.put(`/schema-mapping/${id}`, updates);\n}\nexport async function deleteMappingProfile(id) {\n  // If a delete endpoint exists, update here; otherwise, remove or adjust as needed\n  return await api.delete(`/schema-mapping/${id}`);\n}\n\n// Fetch admin stats\nexport async function fetchAdminStats() {\n  const response = await fetch(\"/api/v1/admin/stats\", {\n    method: \"GET\",\n    headers: {\n      \"accept\": \"application/json\"\n    },\n    credentials: \"include\" // Only if your API requires cookies/session\n  });\n  if (!response.ok) {\n    throw new Error(`Failed to fetch admin stats: ${response.status}`);\n  }\n  return await response.json();\n}\n"],"names":["api","axios","config","method","csrfToken","getCsrfToken","fetchCsrfToken","error","response","showErrorToast","logoutUser","title","message","toast","fetchAdminStats"],"mappings":"gEAKK,MAACA,EAAMC,EAAM,OAAO,CACvB,QAAS,UACT,QAAS,CACP,eAAgB,kBACjB,EACD,gBAAiB,GACjB,QAAS,GACX,CAAC,EAiBDD,EAAI,aAAa,QAAQ,IACvB,MAAOE,GAAW,CAEhB,MAAMC,EAASD,EAAO,QAAUA,EAAO,OAAO,YAAa,EAC3D,GAAI,CAAC,OAAQ,MAAO,QAAS,QAAQ,EAAE,SAASC,CAAM,EAAG,CACvD,IAAIC,EAAYC,EAAc,EACzBD,IACHA,EAAY,MAAME,EAAgB,GAEhCF,IACFF,EAAO,QAAQ,cAAc,EAAIE,EAEzC,CACI,OAAOF,CACR,EACAK,GAAU,QAAQ,OAAOA,CAAK,CACjC,EAMAP,EAAI,aAAa,SAAS,IACvBQ,GAAaA,EACd,MAAOD,GAAU,CACSA,EAAM,OAC9B,KAAM,CAAE,SAAAC,CAAQ,EAAKD,EAGrB,MAAI,CAACC,GAAYA,EAAS,SAAW,KACnCC,EAAeF,CAAK,EACb,QAAQ,OAAOA,CAAK,IAG7BG,EAAY,EACL,QAAQ,OAAOH,CAAK,EAC/B,CACA,EAGA,MAAMG,EAAa,IAAM,CAGnB,OAAO,SAAS,WAAa,WAC/B,OAAO,SAAS,KAAO,SAE3B,EAGMD,EAAkBF,GAAU,CAChC,KAAM,CAAE,SAAAC,CAAQ,EAAKD,EAGrB,GAAIC,GAAYA,EAAS,SAAW,IAAK,OAEzC,IAAIG,EAAQ,QACRC,EAAU,kDAEVJ,EACEA,EAAS,MAAQA,EAAS,KAAK,QACjCI,EAAUJ,EAAS,KAAK,QACfA,EAAS,SAAW,KAC7BG,EAAQ,gBACRC,EAAU,sDACDJ,EAAS,SAAW,KAC7BG,EAAQ,YACRC,EAAU,yCACDJ,EAAS,QAAU,MAC5BG,EAAQ,eACRC,EAAU,oDAEHL,EAAM,UAAY,kBAC3BI,EAAQ,gBACRC,EAAU,2EAGZC,EAAM,CACJ,MAAAF,EACA,YAAaC,EACb,QAAS,aACb,CAAG,CACH,EA+BO,eAAeE,GAAkB,CACtC,MAAMN,EAAW,MAAM,MAAM,sBAAuB,CAClD,OAAQ,MACR,QAAS,CACP,OAAU,kBACX,EACD,YAAa,SACjB,CAAG,EACD,GAAI,CAACA,EAAS,GACZ,MAAM,IAAI,MAAM,gCAAgCA,EAAS,MAAM,EAAE,EAEnE,OAAO,MAAMA,EAAS,KAAM,CAC9B"}
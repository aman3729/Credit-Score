import{r as c,j as e}from"./index-CLIkutcF.js";import{a as M}from"./api-dGCjnlFh.js";const l=({title:t,children:s})=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:t}),e.jsx("div",{children:s})]}),A=({data:t})=>e.jsx("table",{className:"min-w-full text-sm border mb-2",children:e.jsx("tbody",{children:Object.entries(t||{}).map(([s,a])=>e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"px-2 py-1 border font-medium whitespace-nowrap",children:s}),e.jsx("td",{className:"px-2 py-1 border",children:typeof a=="object"&&a!==null?e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 rounded p-2 text-xs overflow-x-auto max-h-40",children:JSON.stringify(a,null,2)}):String(a)})]},s))})}),F=({data:t})=>e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 rounded p-2 text-xs overflow-x-auto max-h-40",children:JSON.stringify(t,null,2)}),m=t=>t?new Date(t).toLocaleString():"—",P=t=>typeof t=="number"?t.toLocaleString():t||"—",_=({value:t})=>e.jsx("span",{className:t?"text-green-600":"text-red-600",children:t?"Yes":"No"}),J=({factors:t})=>e.jsxs("table",{className:"min-w-full text-xs border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"px-2 py-1 border",children:"Factor"}),e.jsx("th",{className:"px-2 py-1 border",children:"Impact"})]})}),e.jsx("tbody",{children:(t||[]).map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:s.name}),e.jsx("td",{className:"px-2 py-1 border",children:e.jsx("span",{className:s.impact==="positive"?"text-green-600":s.impact==="negative"?"text-red-600":"text-gray-600",children:s.impact})})]},s._id||s.name))})]}),z=({history:t})=>e.jsxs("table",{className:"min-w-full text-xs border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"px-2 py-1 border",children:"Date"}),e.jsx("th",{className:"px-2 py-1 border",children:"Decision"}),e.jsx("th",{className:"px-2 py-1 border",children:"Max Loan"}),e.jsx("th",{className:"px-2 py-1 border",children:"Reasons"})]})}),e.jsx("tbody",{children:(t||[]).map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:m(s.evaluatedAt)}),e.jsx("td",{className:"px-2 py-1 border",children:s.decision}),e.jsx("td",{className:"px-2 py-1 border",children:P(s.maxLoanAmount)}),e.jsx("td",{className:"px-2 py-1 border",children:(s.reasons||[]).join(", ")})]},s._id||a))})]}),B=({history:t})=>e.jsxs("table",{className:"min-w-full text-xs border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"px-2 py-1 border",children:"Date"}),e.jsx("th",{className:"px-2 py-1 border",children:"Score"}),e.jsx("th",{className:"px-2 py-1 border",children:"Classification"})]})}),e.jsx("tbody",{children:(t||[]).map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:m(s.date)}),e.jsx("td",{className:"px-2 py-1 border",children:s.score}),e.jsx("td",{className:"px-2 py-1 border",children:s.classification})]},s._id||a))})]}),$=({features:t})=>e.jsxs("table",{className:"min-w-full text-xs border mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"px-2 py-1 border",children:"Feature"}),e.jsx("th",{className:"px-2 py-1 border",children:"Enabled"})]})}),e.jsx("tbody",{children:Object.entries(t||{}).map(([s,a])=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:s.replace(/([A-Z])/g," $1")}),e.jsx("td",{className:"px-2 py-1 border",children:e.jsx(_,{value:a})})]},s))})]}),G=({user:t,onClose:s,onUpdate:a,onDelete:C})=>{var u,v,S,w;const[V,Y]=c.useState(t),[K,W]=c.useState({name:"",impact:"neutral",description:""}),[b,D]=c.useState(!1),[d,j]=c.useState("details"),[R,U]=c.useState([]),[L,y]=c.useState(!1),[g,N]=c.useState(null),[o,I]=c.useState(""),[p,H]=c.useState(""),[h,O]=c.useState("");c.useEffect(()=>{t.role==="lender"&&d==="access"&&(y(!0),N(null),M.get(`/api/v1/users/lenders/${t._id}/access-history`).then(r=>U(r.data.data||[])).catch(r=>N("Failed to load access history")).finally(()=>y(!1)))},[t,d]);const f=R.filter(r=>{var x,k;const i=o?((k=(x=r.targetUserId)==null?void 0:x.toLowerCase)==null?void 0:k.call(x).includes(o.toLowerCase()))||r.targetUserId===o:!0,T=p?r.action===p:!0,E=h?r.timestamp&&r.timestamp.startsWith(h):!0;return i&&T&&E}),n=(r,i)=>!i||typeof i=="object"&&Object.keys(i).length===0?null:e.jsx(l,{title:r,children:e.jsx(A,{data:i})});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"User Details"}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("span",{className:"text-2xl",children:"×"})})]}),t.role==="lender"?e.jsxs("div",{className:"mb-6 flex space-x-4 border-b",children:[e.jsx("button",{className:`pb-2 px-4 font-semibold ${d==="details"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600"}`,onClick:()=>j("details"),children:"Details"}),e.jsx("button",{className:`pb-2 px-4 font-semibold ${d==="access"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600"}`,onClick:()=>j("access"),children:"Lender Access History"})]}):null,(d==="details"||t.role!=="lender")&&e.jsxs(e.Fragment,{children:[n("Profile",{name:t.name,username:t.username,email:t.email,phoneNumber:t.phoneNumber,nationalId:t.nationalId,status:t.status,emailVerified:t.emailVerified,lastLogin:t.lastLogin,createdAt:t.createdAt,updatedAt:t.updatedAt,...t.profile}),n("Financial",{monthlyIncome:t.monthlyIncome,monthlySavings:t.monthlySavings,totalDebt:t.totalDebt,bankBalance:t.bankBalance,mobileMoneyBalance:t.mobileMoneyBalance}),t.creditScore&&e.jsxs(l,{title:"Credit Score",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"FICO Score:"})," ",(u=t.creditScore.fico)==null?void 0:u.score," (",(v=t.creditScore.fico)==null?void 0:v.version,")",e.jsx("br",{}),e.jsx("b",{children:"Classification:"})," ",t.creditScore.classification||"—",e.jsx("br",{}),e.jsx("b",{children:"Last Updated:"})," ",m((S=t.creditScore.fico)==null?void 0:S.lastUpdated)]}),e.jsx(J,{factors:t.creditScore.factors})]}),t.creditReport&&e.jsxs(l,{title:"Credit Report",children:[e.jsx(A,{data:{"Credit Utilization":(w=t.creditReport.creditUtilization)!=null&&w.overall?(t.creditReport.creditUtilization.overall*100).toFixed(1)+"%":"—","Credit Age (months)":t.creditReport.creditAgeMonths,"Credit Mix":t.creditReport.creditMix,"Open Accounts":t.creditReport.openAccounts,"Last Active Date":m(t.creditReport.lastActiveDate),...t.creditReport.personalInfo&&{"Personal Info":t.creditReport.personalInfo}}}),t.creditReport.lendingDecisionHistory&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Lending Decision History"}),e.jsx(z,{history:t.creditReport.lendingDecisionHistory})]})]}),t.creditReport&&t.creditReport.riskFactors&&e.jsx(l,{title:"Risk Factors",children:e.jsx(F,{data:t.creditReport.riskFactors})}),t.scoreHistory&&t.scoreHistory.length>0&&e.jsx(l,{title:"Score History",children:e.jsx(B,{history:t.scoreHistory})}),t.riskFlags&&t.riskFlags.length>0&&e.jsx(l,{title:"Risk Flags",children:e.jsx(F,{data:t.riskFlags})}),t.premium&&t.premium.features&&e.jsx(l,{title:"Premium Features",children:e.jsx($,{features:t.premium.features})}),t.adminFields&&n("Admin Fields",t.adminFields),t.legalConsent&&n("Legal Consent",t.legalConsent),t.preferences&&n("Preferences",t.preferences),t.metadata&&n("Metadata",t.metadata)]}),t.role==="lender"&&d==="access"&&e.jsxs(l,{title:"Lender Access History",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:"Filter by User ID",value:o,onChange:r=>I(r.target.value),className:"border px-2 py-1 rounded text-sm"}),e.jsx("input",{type:"date",value:h,onChange:r=>O(r.target.value),className:"border px-2 py-1 rounded text-sm"}),e.jsxs("select",{value:p,onChange:r=>H(r.target.value),className:"border px-2 py-1 rounded text-sm",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"Credit report accessed",children:"Credit report accessed"}),e.jsx("option",{value:"User profile accessed",children:"User profile accessed"})]})]}),L?e.jsx("div",{children:"Loading..."}):g?e.jsx("div",{className:"text-red-600",children:g}):e.jsxs("table",{className:"min-w-full text-xs border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"px-2 py-1 border",children:"Timestamp"}),e.jsx("th",{className:"px-2 py-1 border",children:"Action"}),e.jsx("th",{className:"px-2 py-1 border",children:"User ID"}),e.jsx("th",{className:"px-2 py-1 border",children:"IP"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-2",children:"No access history found."})}):f.map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border",children:r.timestamp?new Date(r.timestamp).toLocaleString():""}),e.jsx("td",{className:"px-2 py-1 border",children:r.action}),e.jsx("td",{className:"px-2 py-1 border",children:r.targetUserId}),e.jsx("td",{className:"px-2 py-1 border",children:r.ip})]},r._id||i))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{className:"text-blue-600 underline text-sm mb-2",onClick:()=>D(r=>!r),children:b?"Hide Raw JSON":"Show Raw JSON"}),b&&e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 rounded p-2 text-xs overflow-x-auto max-h-96 border",children:JSON.stringify(t,null,2)})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-8",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400",children:"Close"}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this user?")&&C(t._id)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete User"})]})]})})})};export{G as default};
//# sourceMappingURL=AdminUserDetails-caYaZvh2.js.map

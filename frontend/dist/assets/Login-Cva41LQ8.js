import{r as a,u as xe,a as he,j as e,B as l,C as ee}from"./index-CLIkutcF.js";import{C as I,a as D,b as R,c as se,d as q,I as m,e as pe}from"./Combination-VzPjPnOx.js";import{L as x,C as O,M as ge}from"./checkbox-B8vwzNvb.js";import{U as fe,E as je,a as we,L as T}from"./separator-BLcX6XFs.js";import{L as te}from"./lock-BKxMHSyS.js";const be=()=>{try{const{toast:P}=require("../hooks/use-toast");return{toast:h=>P(h)}}catch{return{toast:({title:h,description:k,variant:p="default"})=>{console.log(`[${p.toUpperCase()}] ${h}: ${k}`)}}}},Pe=({onLogin:P})=>{const[h,k]=a.useState("login"),[p,ae]=a.useState(""),[$,re]=a.useState(""),[z,B]=a.useState(!1),[H,u]=a.useState(""),[_,oe]=a.useState(!1),{login:ne}=xe(),f=he(),{toast:F}=be(),L=a.useRef(!0),[ie,j]=a.useState(!1),[E,w]=a.useState(""),[b,r]=a.useState(""),[v,c]=a.useState(""),[y,N]=a.useState(!1),[le,U]=a.useState(!1),[V,C]=a.useState(1),[M,Y]=a.useState(""),[g,G]=a.useState(""),[A,J]=a.useState("");a.useEffect(()=>()=>{L.current=!1},[]);const ce=async s=>{var S,W,K,Q,X,Z;s.preventDefault(),u(""),console.log("[Login] Form submitted with:",{identifier:p.trim(),password:"[HIDDEN]"});const o=p.trim(),n=$.trim();if(!o||!n){u("Please enter both email/phone and password");return}if(n.length<6){u("Password must be at least 6 characters");return}try{console.log("[Login] Setting loading state to true"),B(!0),console.log("[Login] Calling login function with:",{identifier:o,password:"[HIDDEN]"});const t=await ne(o,n);if(console.log("[Login] Login response received:",t),!t){u("Login failed. Please try again.");return}if(t.status&&t.status!=="active"){u("Your account is pending activation. Please visit your nearest branch with your ID."),F({title:"Account Pending Activation",description:"Please visit your nearest branch with your ID.",variant:"warning"});return}F({title:"Login Successful",description:"You have been successfully logged in!",variant:"success"}),t.role==="lender"?f("/lender"):t.role==="admin"?f("/admin"):f("/dashboard")}catch(t){if(!L.current)return;console.error("[Login] Login error:",t);let d="Failed to log in. Please try again.";if(t.response&&t.response.status){const i=t.response;console.log("[Login] Error response:",{status:i.status,data:i.data}),d=((S=i.data)==null?void 0:S.message)||((W=i.data)==null?void 0:W.error)||(i.status===401&&((Q=(K=i.data)==null?void 0:K.error)!=null&&Q.toLowerCase().includes("not active"))?"Your account is pending activation. Please visit your nearest branch with your ID.":i.status===401?"Invalid email or password":i.status===403?"Please verify your email before logging in":i.status===429?"Too many attempts. Please try again later":"An unexpected error occurred")}else t.request?(console.log("[Login] No response received:",t.request),d="No response from server. Please check your connection"):(X=t.message)!=null&&X.includes("Network Error")?(console.log("[Login] Network error:",t.message),d="Network error: Could not reach the server"):t.code==="ECONNABORTED"||(Z=t.message)!=null&&Z.includes("timeout")?(console.log("[Login] Request timeout:",t.message),d="Request timed out. Please try again"):(console.log("[Login] Other error:",t.message),d=t.message||"Failed to log in. Please try again.");u(d),F({title:"Login Failed",description:d,variant:"destructive"})}finally{console.log("[Login] Finally block - resetting loading state"),L.current&&B(!1)}},de=async s=>{s.preventDefault(),r(""),c("");const o=E.trim();if(!o.match(/^\S+@\S+\.\S+$/)){r("Please enter a valid email address");return}N(!0);try{const n=await fetch("/api/v1/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}),S=await n.json();n.ok?(c("A reset code has been sent to your email."),C(2)):r(S.message||"Failed to send reset code.")}catch{r("Network error. Please try again.")}finally{N(!1)}},ue=async s=>{if(s.preventDefault(),r(""),c(""),!M.match(/^\d{6}$/)){r("Please enter the 6-digit code sent to your email.");return}if(!g||g.length<8){r("Password must be at least 8 characters.");return}if(g!==A){r("Passwords do not match.");return}N(!0);try{const o=await fetch("/api/v1/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:E.trim(),code:M,password:g,passwordConfirm:A})}),n=await o.json();o.ok?(c("Password has been reset. You can now log in."),setTimeout(()=>{j(!1),w(""),Y(""),G(""),J(""),C(1),c("")},2e3)):r(n.message||"Failed to reset password.")}catch{r("Network error. Please try again.")}finally{N(!1)}},me=()=>e.jsx("div",{className:"fixed inset-0 bg-black z-0",children:[...Array(50)].map((s,o)=>e.jsx("div",{className:"absolute rounded-full bg-white animate-pulse",style:{top:`${Math.random()*100}%`,left:`${Math.random()*100}%`,width:`${Math.random()*3}px`,height:`${Math.random()*3}px`,opacity:Math.random()*.7+.3,animationDuration:`${Math.random()*5+2}s`}},o))});return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs("div",{className:"min-h-screen flex flex-col relative z-10",children:[e.jsx("header",{className:"w-full pt-8 pb-6 px-6 text-center animate-fade-in",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent mb-2",children:"myMVO"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Welcome back! Please sign in to continue"})]})}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-6 py-8",children:e.jsx("div",{className:"w-full max-w-md space-y-6",children:e.jsxs(I,{className:"border-0 shadow-xl backdrop-blur-lg bg-background/80 animate-slide-up",children:[e.jsxs(D,{className:"space-y-1 pb-6",children:[e.jsxs("div",{className:"flex p-1 space-x-1 bg-muted rounded-lg",children:[e.jsx("button",{onClick:()=>k("login"),className:`flex-1 py-2.5 px-4 text-sm font-medium rounded-md transition-all duration-200 ${h==="login"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Sign In"}),e.jsx("button",{onClick:()=>f("/register"),className:"flex-1 py-2.5 px-4 text-sm font-medium rounded-md transition-all duration-200 text-muted-foreground hover:text-foreground",children:"Create Account"})]}),e.jsx(R,{className:"text-2xl font-bold text-center",children:"Sign In"}),e.jsx(se,{className:"text-center",children:"Enter your credentials to access your account"})]}),e.jsx(q,{className:"space-y-6",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"identifier",className:"text-sm font-medium",children:"Email or Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(m,{id:"identifier",type:"text",value:p,onChange:s=>ae(s.target.value),placeholder:"Enter your email or username",className:"pl-10 h-12 bg-background/50 border-border/50 focus:bg-background focus:border-primary transition-all duration-200",autoComplete:"username"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",className:"text-sm font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(m,{id:"password",type:_?"text":"password",value:$,onChange:s=>re(s.target.value),placeholder:"Enter your password",className:"pl-10 pr-10 h-12 bg-background/50 border-border/50 focus:bg-background focus:border-primary transition-all duration-200",autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>oe(s=>!s),className:"absolute right-3 top-3 h-4 w-4 text-muted-foreground hover:text-foreground transition-colors",children:_?e.jsx(je,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"rounded border-border text-primary focus:ring-primary focus:ring-offset-0"}),e.jsx("span",{className:"text-muted-foreground",children:"Remember me"})]}),e.jsx("button",{type:"button",onClick:()=>j(!0),className:"text-sm text-primary hover:underline",children:"Forgot password?"})]}),H&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm animate-scale-in",children:[e.jsx(O,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:H})]}),e.jsx(l,{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2 h-4 w-4"}),"Signing In..."]}):"Sign In"}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border/50"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"or continue with"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:()=>alert("Google login (mock)"),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("g",{clipPath:"url(#clip0_17_40)",children:[e.jsx("path",{d:"M23.766 12.276c0-.818-.074-1.604-.213-2.356H12.24v4.451h6.484a5.54 5.54 0 01-2.4 3.637v3.017h3.877c2.27-2.092 3.565-5.175 3.565-8.749z",fill:"#4285F4"}),e.jsx("path",{d:"M12.24 24c3.24 0 5.963-1.073 7.95-2.917l-3.877-3.017c-1.08.726-2.457 1.155-4.073 1.155-3.13 0-5.78-2.113-6.734-4.946H1.53v3.09A11.997 11.997 0 0012.24 24z",fill:"#34A853"}),e.jsx("path",{d:"M5.506 14.275a7.19 7.19 0 010-4.55V6.635H1.53a12.002 12.002 0 000 10.73l3.976-3.09z",fill:"#FBBC05"}),e.jsx("path",{d:"M12.24 4.771c1.765 0 3.34.607 4.584 1.8l3.433-3.433C18.2 1.073 15.477 0 12.24 0A11.997 11.997 0 001.53 6.635l3.976 3.09c.954-2.833 3.604-4.954 6.734-4.954z",fill:"#EA4335"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_17_40",children:e.jsx("rect",{width:"24",height:"24",fill:"white"})})})]}),"Continue with Google"]}),e.jsxs(l,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:()=>alert("SSO login (mock)"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Continue with SSO"]})]})]})})]})})}),e.jsx("footer",{className:"w-full py-6 px-6 text-center text-sm text-muted-foreground",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-2",children:[e.jsxs("div",{className:"flex justify-center space-x-6",children:[e.jsx("button",{onClick:()=>U(!0),className:"hover:text-foreground transition-colors",children:"Privacy Policy"}),e.jsx("a",{href:"mailto:support@yourapp.com",className:"hover:text-foreground transition-colors",children:"Support"})]}),e.jsx("p",{children:"© 2024 myMVO. All rights reserved."})]})}),ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm animate-fade-in",children:e.jsxs(I,{className:"w-[90%] max-w-md shadow-xl animate-scale-in",children:[e.jsxs(D,{children:[e.jsx(R,{className:"text-center",children:"Reset Password"}),e.jsx(se,{className:"text-center",children:V===1?"Enter your email to receive a reset code":"Enter the code and your new password"})]}),e.jsx(q,{className:"space-y-4",children:V===1?e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"forgot-email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(m,{id:"forgot-email",type:"email",value:E,onChange:s=>w(s.target.value),placeholder:"Enter your email",className:"pl-10",autoFocus:!0,required:!0})]})]}),b&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm",children:[e.jsx(O,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:b})]}),v&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-green-50 text-green-600 rounded-lg text-sm",children:[e.jsx(ee,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2 h-4 w-4"}),"Sending..."]}):"Send Code"}),e.jsx(l,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{j(!1),w(""),r(""),c(""),C(1)},children:"Cancel"})]})]}):e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"reset-code",children:"6-Digit Code"}),e.jsx(m,{id:"reset-code",type:"text",value:M,onChange:s=>Y(s.target.value),placeholder:"Enter 6-digit code",maxLength:6,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"new-password",children:"New Password"}),e.jsx(m,{id:"new-password",type:"password",value:g,onChange:s=>G(s.target.value),placeholder:"Enter new password",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"confirm-password",children:"Confirm Password"}),e.jsx(m,{id:"confirm-password",type:"password",value:A,onChange:s=>J(s.target.value),placeholder:"Confirm new password",required:!0})]})]}),b&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-destructive/10 text-destructive rounded-lg text-sm",children:[e.jsx(O,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:b})]}),v&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-green-50 text-green-600 rounded-lg text-sm",children:[e.jsx(ee,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2 h-4 w-4"}),"Resetting..."]}):"Reset Password"}),e.jsx(l,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{j(!1),w(""),r(""),c(""),C(1)},children:"Cancel"})]})]})})]})}),le&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm animate-fade-in",children:e.jsxs(I,{className:"w-[90%] max-w-2xl max-h-[80vh] overflow-hidden shadow-xl animate-scale-in",children:[e.jsx(D,{children:e.jsx(R,{className:"text-center",children:"Privacy Policy"})}),e.jsx(q,{className:"overflow-y-auto",children:e.jsxs("div",{className:"prose prose-sm max-w-none text-muted-foreground",children:[e.jsx("p",{className:"mb-4",children:"This is a placeholder for your Privacy Policy."}),e.jsx("p",{className:"mb-4",children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed euismod, nunc ut laoreet dictum, massa erat cursus enim, nec dictum ex enim nec urna. Etiam euismod, urna eu tincidunt consectetur, nisi nisl aliquam nunc, eget aliquam nisl nunc euismod nunc."}),e.jsx("p",{className:"mb-4",children:"Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Integer nec odio. Praesent libero. Sed cursus ante dapibus diam."}),e.jsxs("p",{children:["For more information, contact"," ",e.jsx("a",{href:"mailto:support@yourapp.com",className:"text-primary hover:underline",children:"support@yourapp.com"})]})]})}),e.jsx(pe,{children:e.jsx(l,{onClick:()=>U(!1),className:"w-full",children:"Close"})})]})})]})]})};export{Pe as default};
//# sourceMappingURL=Login-Cva41LQ8.js.map
